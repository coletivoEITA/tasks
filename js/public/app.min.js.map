{"version":3,"sources":["app.js","controllers/appcontroller.js","controllers/detailscontroller.js","controllers/listcontroller.js","controllers/settingscontroller.js","controllers/taskscontroller.js","directives/appnavigationentryutils.js","directives/autofocusoninsert.js","directives/avatar.js","directives/colorpickerDirective.js","directives/confirmation.js","directives/datepicker.js","directives/occlickfocus.js","directives/timepicker.js","directives/watchtop.js","filters/counterFormatter.js","filters/dateDetails.js","filters/dateDetailsShort.js","filters/dateFromNow.js","filters/dateTaskList.js","filters/day.js","filters/dayTaskList.js","filters/percentDetails.js","filters/priorityDetails.js","filters/reminderDetails.js","filters/startDetails.js","filters/timeTaskList.js","services/calendarservice.js","services/davclient.js","services/icalfactory.js","services/loading.js","services/model.js","services/persistence.js","services/publisher.js","services/randomstringservice.js","services/request.js","services/status.js","services/vtodoservice.js","services/businesslayer/listsbusinesslayer.js","services/businesslayer/searchbusinesslayer.js","services/businesslayer/settingsbusinesslayer.js","services/businesslayer/tasksbusinesslayer.js","services/models/calendar.js","services/models/collectionsmodel.js","services/models/listsmodel.js","services/models/settingsmodel.js","services/models/tasksmodel.js","services/models/vtodo.js"],"names":["$","oc_requesttoken","undefined","config","$provide","$routeProvider","$interpolateProvider","$httpProvider","value","defaults","headers","common","requesttoken","when","otherwise","_update","run","$document","$rootScope","Config","$timeout","TasksBusinessLayer","ListsBusinessLayer","SearchBusinessLayer","timeOutUpdate","init","taskUpdateInterval","OCA","Search","tasks","moment","locale","event","calendar","$broadcast","sameDay","lastWeek","t","nextWeek","sameElse","diff","this","m","mm","h","hh","d","dd","M","MM","y","yy","AppController","controller","$scope","$route","status","$location","$routeParams","Loading","SettingsModel","Persistence","_$listsbusinesslayer","_$route","_$scope","_$status","_$timeout","_$location","_$routeparams","_Loading","_$settingsmodel","_persistence","newListName","settingsmodel","currentUser","then","Promise","results","OC","getCurrentUser","all","target","listparameter","length","route","calendarID","is","$event","closest","angular","isUndefined","path","collectionID","focusTaskInput","addingList","addSubtaskTo","isLoading","DetailsController","$window","TasksModel","ListsModel","_$window","_$tasksmodel","_tasksbusinesslayer","_$listsmodel","task","getById","taskID","getByUri","cats","categories","found","add","id","names","timers","durations","name","loadTask","TaskState","related","params","invert","slice","start","deleteTask","$apply","editName","writable","setEditRoute","currentTarget","initDueDate","initStartDate","initReminder","endEdit","resetRoute","keyCode","type","deletePercent","deleteReminder","deleteReminderDate","toggleCompleted","setPercentComplete","toggleStarred","complete","setPriority","isDue","date","isOverDue","overdue","setstartday","setstarttime","setStart","deleteStartDate","setdueday","setduetime","setDue","deleteDueDate","isAllDayPossible","toggleAllDay","setAllDay","allDay","due","setreminderday","setremindertime","setReminderDate","reminderType","reminder","isValid","setReminder","addComment","removeClass","comment","newCommentContent","toString","displayName","time","Date","userID","uid","comms","comments","uri","taskFromServer","doUpdate","next","addClass","deleteComment","i","getTask","splice","default_categories","indexOf","category","model","push","removeCategory","autoGrow","textArea","style","scrollHeight","height","ListController","CollectionsModel","CalendarService","_$routeParams","_$tasksbusinesslayer","_$collectionsmodel","_$searchbusinesslayer","_$calendarservice","collections","draggedTasks","nameError","getAll","color","deleteMessage","replace","displayname","getStandardList","startCreate","tooltip","isAddingList","startEdit","prepareUpdate","download","url","open","checkNew","checkEdit","cancelEdit","checkName","allowed","$input","isNameAllowed","check","preventDefault","msg","placement","trigger","$on","s","calendarUri","resetToPreviousState","saveEdit","rename","isNameAlreadyTaken","getCount","filter","hideCollection","collection","show","getFilter","dragoverList","listID","index","attr","dropList","item","changeCalendar","dragoverCollection","effectAllowed","dataTransfer","ctrlKey","dropCollection","changeCollection","dropEffect","SettingsController","Status","SettingsBusinessLayer","_$settingsbusinesslayer","collectionOptions","getStatus","startOfWeekOptions","setVisibility","setStartOfWeek","set","__indexOf","l","module","TasksController","_settingsbusinesslayer","_searchbusinesslayer","VTodo","vtodo","_vtodo","calendars","days","isAddingTask","focusInputField","addTask","taskName","_ref","parent","summary","priority","completed","note","startOf","format","openDetails","focusSubtaskInput","subtaskName","getAddString","isDefined","showSubtaskInput","taskname","hideSubtasks","descendantIDs","loadedCompleted","toggle","filterTasks","getSubTasks","_i","_len","hideCompletedSubtasks","ret","hasNoParent","hasCompletedSubtasks","toggleSubtasks","toggleCompletedSubtasks","filterTasksByString","filteredTasks","dayHasEntry","taskAtDay","day","filterLists","getCountString","checkTaskInput","setLoadedCompleted","sortDue","sortStart","sortOrder","getSortOrderIcon","order","sortDirection","dropAsSubtask","parentID","changeParent","newCalendar","queries","makeRootTask","children","allow","dragStart","dragEnd","directive","elm","button","find","menu","toggleClass","scope","focus","avatar","userid","$observe","size","saturation","hue","isArray","lightness","huePrime","red","chroma","Math","abs","floor","blue","secondComponent","green","lightnessAdjustment","rgbToHex","round","r","g","b","Array","listofcolours","parseInt","randColour","String","random","hslToRgb","toHsl","prototype","forEach","hsl","hash","hslcolour","restrict","templateUrl","filePath","colors","selected","element","randomizeColour","pick","confirmationFunction","confirmationMessage","ConfirmationController","$element","$attrs","$compile","countdown","message","hasClass","stopPropagation","activate","bind","e","html","documentClick","unbind","onSelect","datepicker","inst","beforeShow","input","marginLeft","outerWidth","dp","css","margin-left","left","startOfWeek","minDate","options","selector","click","timeout","timepicker","atPosition","myPosition","minuteText","hourText","divTop","$watch","prev","outerHeight","count","isDate","fromNow","percent","string","ds","duration","token","tokenName","after","_this","service","DavClient","Calendar","discoverHome","callback","propFind","buildUrl","linkToRemoteBase","NS_DAV","requestToken","response","props","propStat","wasRequestSuccessful","textContent","_currentUserPrincipal","NS_IETF","body","properties","_CALENDAR_HOME","split","_PROPERTIES","NS_APPLE","NS_OWNCLOUD","responseCode","getResponseCodeFromHTTPResponse","doesSupportVTodo","components","attributes","getNamedItem","j","toLowerCase","get","href","substr","create","document","cMkcalendar","setAttribute","createDocument","createElement","xmlDoc","appendChild","dProp","dSet","_createXMLForProperty","outerHTML","_suggestUri","request","enabled","_takenUrls","update","dPropUpdate","updatedProperties","resetUpdatedProperties","delete","oShare","shareType","shareWith","existingShare","implementation","oSet","dHref","Share","SHARE_TYPE_USER","SHARE_TYPE_GROUP","oSummary","owner","oRW","Content-Type","users","sharedWith","oRemove","user","groups","propName","oEnabled","dDisplayname","aOrder","aColor","cComponents","cComp","toUpperCase","acl","canWrite","getElementsByTagNameNS","k","writeNode","_isUriAlreadyTaken","lastPart","positionLastDash","match","firstPart","client","xmlNamespaces","dav","Client","linkToRemote","DAV:","urn:ietf:params:xml:ns:caldav","http://apple.com/ns/ical/","http://owncloud.org/ns","http://nextcloud.com/ns","NS_NEXTCLOUD","NS_CALENDARSERVER","location","protocol","window","host","root","updatePropertyWithValue","version","factory","decrease","Model","_dataMap","_filterCache","_data","data","_results","clearCache","_invalidateCache","entry","key","removeById","counter","query","hashCode","exec","Request","$q","_$rootScope","_CalendarService","deferred","defer","successCallback","getCollections","getSettings","resolve","successCallbackWrapper","onSuccess","showLoading","failureCallbackWrapper","_request","onFailure","visibility","routeParams","setting","post","Publisher","_subscriptions","subscribeObjectTo","object","base","publishDataTo","ref","subscriber","handle","generate","$http","publisher","initialized","shelvedRequests","_executeShelvedRequests","defaultConfig","defaultData","extend","method","catch","put","_shelveRequest","RandomStringService","cCalQuery","dGetEtag","cCalendarData","cFilter","cCompFilterVCal","cCompFilterVTodo","cPropFilterCompleted","cIsNotDefined","cTextMatch","cPropFilterRelated","cTextMatchValue","createTextNode","Depth","vTodos","lastIndexOf","vTodo","{urn:ietf:params:xml:ns:caldav}calendar-data","{DAV:}getetag","xhr","getResponseHeader","returnTodo","_generateRandomUri","console","log","cancel","etag","__bind","fn","me","setFilter","attach","initialize","_$searchString","search","setRenderer","result","renderTaskResult","$row","$template","calendarid","isLoaded","clone","append","text","width","background-color","getColor","success","updateModel","VTodoService","_$vtodoservice","_$vtodo","ad","uncompleteParents","percentComplete","triggerUpdate","completeChildren","child","getChildren","getByUid","setHideSubtasks","hide","setHideCompletedSubtasks","momentToICALTime","asDate","ICAL","Time","fromDateString","reference","isAfter","olddue","year","month","hour","minute","isBefore","isSame","subtract","oldstart","checkReminderDate","second","p","newreminder","reminderdate","action","rel","seg","week","secondsToSegments","w","newTask","newVTodo","requests","commentID","$filter","vjournal","vevent","shareable","_updatedProperties","_properties","hasOwnProperty","shares","access","readWrite","startsWith","origin","_setUpdated","c","regex","_generateTextColor","_propertiesBackup","copy","dropPreviousState","toggleSharesEditor","list","brightness","editingShares","__hasProp","call","Ctor","_Model","__super__","__extends","_super","_nameCache","updateByUri","tmplist","_tmpIdCache","calendarcolor","getName","removeByList","taskIDs","_j","_len1","startdiff","duediff","hasSubtasks","getIdByUid","getDescendantIDs","concat","current","today","needle","ancestors","objectExists","getAncestor","keys","searchComments","searchCategories","updateComment","com","tmpID","icalfactory","loaded","jCal","Component","loadComments","getAllSubcomponents","getFirstPropertyValue","updateLastModified","vtodos","now","removeProperty","completed_date","toJSDate","comp","getFirstProperty","getValues","setValues","prop","Property","addProperty","_comments","removeAllProperties","addPropertyWithValue","stringify","JSON","commentRaw","getAllProperties","commentObject","parse","val","addSubcomponent"],"mappings":"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","file":"app.min.js","sourcesContent":["'use strict';\n\nangular.module('Tasks', ['ngRoute', 'ngAnimate', 'ui.select', 'ngSanitize', 'dndLists']).config(['$provide', '$routeProvider', '$interpolateProvider', '$httpProvider', function ($provide, $routeProvider, $interpolateProvider, $httpProvider) {\n\t'use strict';\n\n\tvar config;\n\t$provide.value('Config', config = {\n\t\tmarkReadTimeout: 500,\n\t\ttaskUpdateInterval: 1000 * 600\n\t});\n\t$httpProvider.defaults.headers.common.requesttoken = oc_requesttoken;\n\t$routeProvider.when('/calendars/:calendarID', {}).when('/calendars/:calendarID/edit/:listparameter', {}).when('/calendars/:calendarID/tasks/:taskID', {}).when('/calendars/:calendarID/tasks/:taskID/settings', {}).when('/calendars/:calendarID/tasks/:taskID/edit/:parameter', {}).when('/collections/:collectionID/tasks/:taskID', {}).when('/collections/:collectionID/tasks/:taskID/settings', {}).when('/collections/:collectionID/tasks/:taskID/edit/:parameter', {}).when('/collections/:collectionID', {}).when('/search/:searchString', {}).when('/search/:searchString/tasks/:taskID', {}).when('/search/:searchString/tasks/:taskID/edit/:parameter', {}).otherwise({\n\t\tredirectTo: '/collections/all'\n\t});\n}]);\n\nangular.module('Tasks').run(['$document', '$rootScope', 'Config', '$timeout', 'ListsBusinessLayer', 'TasksBusinessLayer', 'SearchBusinessLayer', function ($document, $rootScope, Config, $timeout, TasksBusinessLayer, ListsBusinessLayer, SearchBusinessLayer) {\n\t'use strict';\n\n\tvar _update;\n\tvar init = false;\n\t(_update = function update() {\n\t\tvar timeOutUpdate;\n\t\ttimeOutUpdate = function timeOutUpdate() {\n\t\t\treturn $timeout(_update, Config.taskUpdateInterval);\n\t\t};\n\t\tinit = true;\n\t\treturn timeOutUpdate();\n\t}).call();\n\tOCA.Search.tasks = SearchBusinessLayer;\n\t$document.click(function (event) {\n\t\t$rootScope.$broadcast('documentClicked', event);\n\t});\n\tmoment.locale('details', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Due yesterday') + '], HH:mm',\n\t\t\tsameDay: '[' + t('tasks', 'Due today') + '], HH:mm',\n\t\t\tnextDay: '[' + t('tasks', 'Due tomorrow') + '], HH:mm',\n\t\t\tlastWeek: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY, HH:mm',\n\t\t\tnextWeek: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY, HH:mm',\n\t\t\tsameElse: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY, HH:mm'\n\t\t}\n\t});\n\tmoment.locale('details_allday', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Due yesterday') + ']',\n\t\t\tsameDay: '[' + t('tasks', 'Due today') + ']',\n\t\t\tnextDay: '[' + t('tasks', 'Due tomorrow') + ']',\n\t\t\tlastWeek: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY',\n\t\t\tnextWeek: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY',\n\t\t\tsameElse: '[' + t('tasks', 'Due on') + '] MMM DD, YYYY'\n\t\t}\n\t});\n\tmoment.locale('start', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Started yesterday') + '], HH:mm',\n\t\t\tsameDay: '[' + t('tasks', 'Starts today') + '], HH:mm',\n\t\t\tnextDay: '[' + t('tasks', 'Starts tomorrow') + '], HH:mm',\n\t\t\tlastWeek: '[' + t('tasks', 'Started on') + '] MMM DD, YYYY, HH:mm',\n\t\t\tnextWeek: '[' + t('tasks', 'Starts on') + '] MMM DD, YYYY, HH:mm',\n\t\t\tsameElse: function sameElse() {\n\t\t\t\tif (this.diff(moment()) > 0) {\n\t\t\t\t\treturn '[' + t('tasks', 'Starts on') + '] MMM DD, YYYY, HH:mm';\n\t\t\t\t} else {\n\t\t\t\t\treturn '[' + t('tasks', 'Started on') + '] MMM DD, YYYY, HH:mm';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\tmoment.locale('start_allday', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Started yesterday') + ']',\n\t\t\tsameDay: '[' + t('tasks', 'Starts today') + ']',\n\t\t\tnextDay: '[' + t('tasks', 'Starts tomorrow') + ']',\n\t\t\tlastWeek: '[' + t('tasks', 'Started on') + '] MMM DD, YYYY',\n\t\t\tnextWeek: '[' + t('tasks', 'Starts on') + '] MMM DD, YYYY',\n\t\t\tsameElse: function sameElse() {\n\t\t\t\tif (this.diff(moment()) > 0) {\n\t\t\t\t\treturn '[' + t('tasks', 'Starts on') + '] MMM DD, YYYY';\n\t\t\t\t} else {\n\t\t\t\t\treturn '[' + t('tasks', 'Started on') + '] MMM DD, YYYY';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\tmoment.locale('reminder', {\n\t\tcalendar: {\n\t\t\tlastDay: t('tasks', '[Remind me yesterday at ]HH:mm'),\n\t\t\tsameDay: t('tasks', '[Remind me today at ]HH:mm'),\n\t\t\tnextDay: t('tasks', '[Remind me tomorrow at ]HH:mm'),\n\t\t\tlastWeek: t('tasks', '[Remind me on ]MMM DD, YYYY,[ at ]HH:mm'),\n\t\t\tnextWeek: t('tasks', '[Remind me on ]MMM DD, YYYY,[ at ]HH:mm'),\n\t\t\tsameElse: t('tasks', '[Remind me on ]MMM DD, YYYY,[ at ]HH:mm')\n\t\t}\n\t});\n\tmoment.locale('tasks', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Yesterday') + ']',\n\t\t\tsameDay: '[' + t('tasks', 'Today') + ']',\n\t\t\tnextDay: '[' + t('tasks', 'Tomorrow') + ']',\n\t\t\tlastWeek: 'DD.MM.YYYY',\n\t\t\tnextWeek: 'DD.MM.YYYY',\n\t\t\tsameElse: 'DD.MM.YYYY'\n\t\t}\n\t});\n\tmoment.locale('details_short', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Yesterday') + ']',\n\t\t\tsameDay: '[' + t('tasks', 'Today') + ']',\n\t\t\tnextDay: '[' + t('tasks', 'Tomorrow') + ']',\n\t\t\tlastWeek: 'MMM DD, YYYY',\n\t\t\tnextWeek: 'MMM DD, YYYY',\n\t\t\tsameElse: 'MMM DD, YYYY'\n\t\t}\n\t});\n\tmoment.locale('list_week', {\n\t\tcalendar: {\n\t\t\tlastDay: '[' + t('tasks', 'Yesterday') + ']',\n\t\t\tsameDay: '[' + t('tasks', 'Today') + '], MMM. DD',\n\t\t\tnextDay: '[' + t('tasks', 'Tomorrow') + '], MMM. DD',\n\t\t\tlastWeek: 'ddd, MMM. DD',\n\t\t\tnextWeek: 'ddd, MMM. DD',\n\t\t\tsameElse: 'ddd, MMM. DD'\n\t\t}\n\t});\n\treturn moment.locale('en', {\n\t\trelativeTime: {\n\t\t\tfuture: t('tasks', \"in %s\"),\n\t\t\tpast: t('tasks', \"%s ago\"),\n\t\t\ts: t('tasks', \"seconds\"),\n\t\t\tm: t('tasks', \"a minute\"),\n\t\t\tmm: t('tasks', \"%d minutes\"),\n\t\t\th: t('tasks', \"an hour\"),\n\t\t\thh: t('tasks', \"%d hours\"),\n\t\t\td: t('tasks', \"a day\"),\n\t\t\tdd: t('tasks', \"%d days\"),\n\t\t\tM: t('tasks', \"a month\"),\n\t\t\tMM: t('tasks', \"%d months\"),\n\t\t\ty: t('tasks', \"a year\"),\n\t\t\tyy: t('tasks', \"%d years\")\n\t\t}\n\t});\n}]);","'use strict';\n\nangular.module('Tasks').controller('AppController', ['$scope', '$rootScope', 'ListsBusinessLayer', '$route', 'Status', '$timeout', '$location', '$routeParams', 'Loading', 'SettingsModel', 'Persistence', function ($scope, $rootScope, ListsBusinessLayer, $route, status, $timeout, $location, $routeParams, Loading, SettingsModel, Persistence) {\n\t'use strict';\n\n\tvar AppController = function () {\n\t\tfunction AppController(_$scope, $rootScope, _$listsbusinesslayer, _$route, _$status, _$timeout, _$location, _$routeparams, _Loading, _$settingsmodel, _persistence) {\n\t\t\tthis._$scope = _$scope;\n\t\t\tthis._$listsbusinesslayer = _$listsbusinesslayer;\n\t\t\tthis._$route = _$route;\n\t\t\tthis._$status = _$status;\n\t\t\tthis._$timeout = _$timeout;\n\t\t\tthis._$location = _$location;\n\t\t\tthis._$routeparams = _$routeparams;\n\t\t\tthis._Loading = _Loading;\n\t\t\tthis._$settingsmodel = _$settingsmodel;\n\t\t\tthis._persistence = _persistence;\n\t\t\tthis._$scope.status = this._$status.getStatus();\n\t\t\tthis._$scope.route = this._$routeparams;\n\t\t\tthis._$scope.status.newListName = \"\";\n\t\t\tthis._$scope.settingsmodel = this._$settingsmodel;\n\t\t\tthis._$scope.currentUser = OC.getCurrentUser();\n\n\t\t\tthis._$listsbusinesslayer.init().then(function (results) {\n\t\t\t\tPromise.all(results).then(function () {\n\t\t\t\t\t$scope.$apply();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis._persistence.init();\n\n\t\t\tthis._$scope.closeAll = function ($event) {\n\t\t\t\tif ($($event.target).closest('.close-all').length || $($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\tif (!angular.isUndefined(_$scope.route.calendarID)) {\n\t\t\t\t\t\tif (_$scope.route.listparameter === 'name') {\n\t\t\t\t\t\t\t$rootScope.$broadcast('cancelEditCalendar', _$scope.route.calendarID);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_$location.path('/calendars/' + _$scope.route.calendarID);\n\t\t\t\t\t} else if (!angular.isUndefined(_$scope.route.collectionID)) {\n\t\t\t\t\t\t_$location.path('/collections/' + _$scope.route.collectionID);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_$location.path('/collections/all');\n\t\t\t\t\t}\n\t\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t\t_$scope.status.focusTaskInput = false;\n\t\t\t\t\t_$scope.status.newListName = \"\";\n\t\t\t\t}\n\t\t\t\tif (!$($event.target).closest('.newList').length) {\n\t\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t\t_$scope.status.newListName = \"\";\n\t\t\t\t}\n\t\t\t\tif (!$($event.target).closest('.add-subtask').length) {\n\t\t\t\t\t_$scope.status.addSubtaskTo = null;\n\t\t\t\t\t_$scope.status.focusSubtaskInput = false;\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.isLoading = function () {\n\t\t\t\treturn _Loading.isLoading();\n\t\t\t};\n\t\t}\n\t\treturn AppController;\n\t}();\n\treturn new AppController($scope, $rootScope, ListsBusinessLayer, $route, status, $timeout, $location, $routeParams, Loading, SettingsModel, Persistence);\n}]);","'use strict';\n\nangular.module('Tasks').controller('DetailsController', ['$scope', '$window', 'TasksModel', 'TasksBusinessLayer', '$route', '$location', '$timeout', '$routeParams', 'SettingsModel', 'Loading', 'ListsModel', function ($scope, $window, TasksModel, TasksBusinessLayer, $route, $location, $timeout, $routeParams, SettingsModel, Loading, ListsModel) {\n\t'use strict';\n\n\tvar DetailsController = function () {\n\t\tfunction DetailsController(_$scope, _$window, _$tasksmodel, _tasksbusinesslayer, _$route, _$location, _$timeout, _$routeparams, _$settingsmodel, _Loading, _$listsmodel) {\n\t\t\tthis._$scope = _$scope;\n\t\t\tthis._$window = _$window;\n\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\tthis._$listsmodel = _$listsmodel;\n\t\t\tthis._tasksbusinesslayer = _tasksbusinesslayer;\n\t\t\tthis._$route = _$route;\n\t\t\tthis._$location = _$location;\n\t\t\tthis._$timeout = _$timeout;\n\t\t\tthis._$routeparams = _$routeparams;\n\t\t\tthis._$settingsmodel = _$settingsmodel;\n\t\t\tthis._Loading = _Loading;\n\t\t\tthis._$scope.task = _$tasksmodel.getById(_$scope.route.taskID);\n\t\t\tthis._$scope.found = true;\n\t\t\tthis._$scope.$on('$routeChangeSuccess', function () {\n\t\t\t\tvar task = _$tasksmodel.getByUri(_$scope.route.taskID);\n\n\t\t\t\tif (!(angular.isUndefined(task) || task === null)) {\n\t\t\t\t\t_$scope.task = task;\n\t\t\t\t\t// Bind categories to task.cats as angular.ui/ui-select seems to have problems with Getter/Setter\n\t\t\t\t\t_$scope.task.cats = task.categories;\n\t\t\t\t\t_$scope.found = true;\n\t\t\t\t} else if (_$scope.route.taskID !== void 0) {\n\t\t\t\t\t_$scope.found = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._$scope.settingsmodel = this._$settingsmodel;\n\t\t\tthis._$scope.settingsmodel.add({\n\t\t\t\t'id': 'various',\n\t\t\t\t'categories': []\n\t\t\t});\n\t\t\tthis._$scope.timers = [];\n\t\t\tthis._$scope.durations = [{\n\t\t\t\tname: t('tasks', 'week'),\n\t\t\t\tnames: t('tasks', 'weeks'),\n\t\t\t\tid: 'week'\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'day'),\n\t\t\t\tnames: t('tasks', 'days'),\n\t\t\t\tid: 'day'\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'hour'),\n\t\t\t\tnames: t('tasks', 'hours'),\n\t\t\t\tid: 'hour'\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'minute'),\n\t\t\t\tnames: t('tasks', 'minutes'),\n\t\t\t\tid: 'minute'\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'second'),\n\t\t\t\tnames: t('tasks', 'seconds'),\n\t\t\t\tid: 'second'\n\t\t\t}];\n\t\t\tthis._$scope.loadTask = function (taskID) {\n\t\t\t\tvar task = _$tasksmodel.getByUri(_$scope.route.taskID);\n\t\t\t\tif (!(angular.isUndefined(task) || task === null)) {\n\t\t\t\t\t_$scope.task = task;\n\t\t\t\t\t_$scope.found = true;\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.TaskState = function () {\n\t\t\t\tif (_$scope.found) {\n\t\t\t\t\treturn 'found';\n\t\t\t\t} else {\n\t\t\t\t\tif (_Loading.isLoading()) {\n\t\t\t\t\t\treturn 'loading';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.params = [{\n\t\t\t\tname: t('tasks', 'before beginning'),\n\t\t\t\tinvert: true,\n\t\t\t\trelated: 'START',\n\t\t\t\tid: \"10\"\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'after beginning'),\n\t\t\t\tinvert: false,\n\t\t\t\trelated: 'START',\n\t\t\t\tid: \"00\"\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'before end'),\n\t\t\t\tinvert: true,\n\t\t\t\trelated: 'END',\n\t\t\t\tid: \"11\"\n\t\t\t}, {\n\t\t\t\tname: t('tasks', 'after end'),\n\t\t\t\tinvert: false,\n\t\t\t\trelated: 'END',\n\t\t\t\tid: \"01\"\n\t\t\t}];\n\t\t\tthis._$scope.filterParams = function (params) {\n\t\t\t\tvar task;\n\t\t\t\ttask = _$tasksmodel.getById(_$scope.route.taskID);\n\t\t\t\tif (!(angular.isUndefined(task) || task === null)) {\n\t\t\t\t\tif (task.due && task.start) {\n\t\t\t\t\t\treturn params;\n\t\t\t\t\t} else if (task.start) {\n\t\t\t\t\t\treturn params.slice(0, 2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn params.slice(2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.deleteTask = function (task) {\n\t\t\t\treturn _$timeout(function () {\n\t\t\t\t\treturn _tasksbusinesslayer.deleteTask(task).then(function () {\n\t\t\t\t\t\treturn $scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t};\n\t\t\tthis._$scope.triggerUpdate = function (task) {\n\t\t\t\t_tasksbusinesslayer.triggerUpdate(task);\n\t\t\t};\n\t\t\tthis._$scope.editName = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif (!$($event.target).is('a')) {\n\t\t\t\t\t\t_$scope.setEditRoute('name');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editDueDate = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\t_$scope.setEditRoute('duedate');\n\t\t\t\t\t\t_tasksbusinesslayer.initDueDate(task);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editStart = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\t_$scope.setEditRoute('startdate');\n\t\t\t\t\t\t_tasksbusinesslayer.initStartDate(task);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editReminder = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\t_$scope.setEditRoute('reminer');\n\t\t\t\t\t\treturn _tasksbusinesslayer.initReminder(_$scope.route.taskID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editNote = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\tif (!$($event.target).is('a')) {\n\t\t\t\t\t\t\t_$scope.setEditRoute('note');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editPriority = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\t_$scope.setEditRoute('priority');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.editPercent = function ($event, task) {\n\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\tif ($($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\t_$scope.setEditRoute('percent');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.endEdit = function ($event) {\n\t\t\t\tif ($($event.target).closest('.end-edit').length || $($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t_$scope.resetRoute();\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.endName = function ($event) {\n\t\t\t\tif ($event.keyCode === 13) {\n\t\t\t\t\t$event.preventDefault();\n\t\t\t\t\t_$scope.resetRoute();\n\t\t\t\t}\n\t\t\t\tif ($event.keyCode === 27) {\n\t\t\t\t\treturn _$scope.resetRoute();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.setEditRoute = function (type) {\n\t\t\t\tvar calendarID = _$scope.route.calendarID;\n\t\t\t\tvar collectionID = _$scope.route.collectionID;\n\t\t\t\tif (calendarID) {\n\t\t\t\t\t$location.path('/calendars/' + calendarID + '/tasks/' + _$scope.route.taskID + '/edit/' + type);\n\t\t\t\t} else if (collectionID) {\n\t\t\t\t\t$location.path('/collections/' + collectionID + '/tasks/' + _$scope.route.taskID + '/edit/' + type);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.resetRoute = function () {\n\t\t\t\tvar calendarID = _$scope.route.calendarID;\n\t\t\t\tvar collectionID = _$scope.route.collectionID;\n\t\t\t\tif (calendarID) {\n\t\t\t\t\t$location.path('/calendars/' + calendarID + '/tasks/' + _$scope.route.taskID);\n\t\t\t\t} else if (collectionID) {\n\t\t\t\t\t$location.path('/collections/' + collectionID + '/tasks/' + _$scope.route.taskID);\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.deletePercent = function (task) {\n\t\t\t\treturn _tasksbusinesslayer.setPercentComplete(task, 0);\n\t\t\t};\n\t\t\tthis._$scope.deleteReminder = function () {\n\t\t\t\treturn _tasksbusinesslayer.deleteReminderDate(_$scope.route.taskID);\n\t\t\t};\n\n\t\t\tthis._$scope.toggleCompleted = function (task) {\n\t\t\t\tif (task.completed) {\n\t\t\t\t\t_tasksbusinesslayer.setPercentComplete(task, 0);\n\t\t\t\t} else {\n\t\t\t\t\t_tasksbusinesslayer.setPercentComplete(task, 100);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.setPercentComplete = function (task, complete) {\n\t\t\t\t_tasksbusinesslayer.setPercentComplete(task, complete);\n\t\t\t};\n\n\t\t\tthis._$scope.toggleStarred = function (task) {\n\t\t\t\tif (task.priority > 5) {\n\t\t\t\t\t_tasksbusinesslayer.setPriority(task, 0);\n\t\t\t\t} else {\n\t\t\t\t\t_tasksbusinesslayer.setPriority(task, 9);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.deletePriority = function (task) {\n\t\t\t\treturn _tasksbusinesslayer.setPriority(task, 0);\n\t\t\t};\n\t\t\tthis._$scope.isDue = function (date) {\n\t\t\t\treturn _$tasksmodel.due(date);\n\t\t\t};\n\t\t\tthis._$scope.isOverDue = function (date) {\n\t\t\t\treturn _$tasksmodel.overdue(date);\n\t\t\t};\n\n\t\t\tthis._$scope.setstartday = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setStart(_$scope.task, moment(date, 'MM/DD/YYYY'), 'day');\n\t\t\t};\n\t\t\tthis._$scope.setstarttime = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setStart(_$scope.task, moment(date, 'HH:mm'), 'time');\n\t\t\t};\n\t\t\tthis._$scope.deleteStartDate = function (task) {\n\t\t\t\t_tasksbusinesslayer.deleteStartDate(task);\n\t\t\t};\n\n\t\t\tthis._$scope.setdueday = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setDue(_$scope.task, moment(date, 'MM/DD/YYYY'), 'day');\n\t\t\t};\n\t\t\tthis._$scope.setduetime = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setDue(_$scope.task, moment(date, 'HH:mm'), 'time');\n\t\t\t};\n\t\t\tthis._$scope.deleteDueDate = function (task) {\n\t\t\t\t_tasksbusinesslayer.deleteDueDate(task);\n\t\t\t};\n\n\t\t\tthis._$scope.isAllDayPossible = function (task) {\n\t\t\t\treturn !angular.isUndefined(task) && task.calendar.writable && (task.due || task.start);\n\t\t\t};\n\t\t\tthis._$scope.toggleAllDay = function (task) {\n\t\t\t\t_tasksbusinesslayer.setAllDay(task, !task.allDay);\n\t\t\t};\n\n\t\t\tthis._$scope.setreminderday = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setReminderDate(_$scope.route.taskID, moment(date, 'MM/DD/YYYY'), 'day');\n\t\t\t};\n\t\t\tthis._$scope.setremindertime = function (date) {\n\t\t\t\treturn _tasksbusinesslayer.setReminderDate(_$scope.route.taskID, moment(date, 'HH:mm'), 'time');\n\t\t\t};\n\t\t\tthis._$scope.reminderType = function (task) {\n\t\t\t\tif (!angular.isUndefined(task)) {\n\t\t\t\t\tif (task.reminder === null) {\n\t\t\t\t\t\tif (moment(task.start, \"YYYYMMDDTHHmmss\").isValid() || moment(task.due, \"YYYYMMDDTHHmmss\").isValid()) {\n\t\t\t\t\t\t\treturn 'DURATION';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn 'DATE-TIME';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn task.reminder.type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._$scope.changeReminderType = function (task) {\n\t\t\t\t_tasksbusinesslayer.checkReminderDate(task.id);\n\t\t\t\tif (this.reminderType(task) === 'DURATION') {\n\t\t\t\t\tif (task.reminder) {\n\t\t\t\t\t\ttask.reminder.type = 'DATE-TIME';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttask.reminder = {\n\t\t\t\t\t\t\ttype: 'DATE-TIME'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (task.reminder) {\n\t\t\t\t\t\ttask.reminder.type = 'DURATION';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttask.reminder = {\n\t\t\t\t\t\t\ttype: 'DURATION'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn _tasksbusinesslayer.setReminder(task.id);\n\t\t\t};\n\t\t\tthis._$scope.setReminderDuration = function (taskID) {\n\t\t\t\treturn _tasksbusinesslayer.setReminder(_$scope.route.taskID);\n\t\t\t};\n\t\t\tthis._$scope.addComment = function ($event, task, newCommentContent) {\n\t\t\t\t$($event.target).next('.submitLoading').removeClass('hidden');\n\t\t\t\t$($event.target).prev('.message').val('');\n\t\t\t\tvar comment = {\n\t\t\t\t\tid: Date.now().toString(),\n\t\t\t\t\tdisplayName: OC.getCurrentUser().displayName,\n\t\t\t\t\tcomment: newCommentContent,\n\t\t\t\t\ttime: moment(),\n\t\t\t\t\tuserID: OC.getCurrentUser().uid\n\t\t\t\t};\n\t\t\t\t_tasksbusinesslayer.getTask(task.calendar, task.uri).then(function (taskFromServer) {\n\t\t\t\t\tvar comms = taskFromServer.comments;\n\t\t\t\t\tcomms.unshift(comment);\n\t\t\t\t\t_$scope.task.comments = comms;\n\t\t\t\t\t_tasksbusinesslayer.doUpdate(task).then(function () {\n\t\t\t\t\t\t$($event.target).next('.submitLoading').addClass('hidden');\n\t\t\t\t\t\t_$scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t};\n\t\t\tthis._$scope.deleteComment = function ($event, task, comment) {\n\t\t\t\t$($event.target).removeClass('icon-delete').addClass('icon-loading-small');\n\t\t\t\t_tasksbusinesslayer.getTask(task.calendar, task.uri).then(function (taskFromServer) {\n\t\t\t\t\tvar comms = taskFromServer.comments;\n\t\t\t\t\tfor (var i = 0; i < comms.length; i++) {\n\t\t\t\t\t\tif (comms[i].id === comment.id) {\n\t\t\t\t\t\t\tcomms.splice(i, 1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t_$scope.task.comments = comms;\n\t\t\t\t\t_tasksbusinesslayer.doUpdate(task).then(function () {\n\t\t\t\t\t\t$($event.target).removeClass('icon-loading-small').addClass('icon-delete');\n\t\t\t\t\t\t_$scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t};\n\t\t\tthis._$scope.addCategory = function (category, model) {\n\t\t\t\t_$scope.task.categories = _$scope.task.cats;\n\t\t\t\tvar default_categories = _$scope.settingsmodel.getById('various').categories;\n\t\t\t\tif (default_categories.indexOf(category) < 0) {\n\t\t\t\t\tdefault_categories.push(category);\n\t\t\t\t}\n\t\t\t\t_tasksbusinesslayer.doUpdate(_$scope.task);\n\t\t\t};\n\t\t\tthis._$scope.removeCategory = function (category, model) {\n\t\t\t\t_$scope.task.categories = _$scope.task.cats;\n\t\t\t\t_tasksbusinesslayer.doUpdate(_$scope.task);\n\t\t\t};\n\t\t\tthis._$scope.autoGrow = function ($event) {\n\t\t\t\tvar textArea = $event.target;\n\t\t\t\ttextArea.style.height = '0px';\n\t\t\t\ttextArea.style.height = textArea.scrollHeight + 'px';\n\t\t\t};\n\t\t}\n\n\t\treturn DetailsController;\n\t}();\n\treturn new DetailsController($scope, $window, TasksModel, TasksBusinessLayer, $route, $location, $timeout, $routeParams, SettingsModel, Loading, ListsModel);\n}]);","'use strict';\n\nangular.module('Tasks').controller('ListController', ['$scope', '$rootScope', '$window', '$routeParams', 'ListsModel', 'TasksBusinessLayer', 'CollectionsModel', 'ListsBusinessLayer', '$location', 'SearchBusinessLayer', 'CalendarService', 'TasksModel', '$timeout', function ($scope, $rootScope, $window, $routeParams, ListsModel, TasksBusinessLayer, CollectionsModel, ListsBusinessLayer, $location, SearchBusinessLayer, CalendarService, TasksModel, $timeout) {\n\t'use strict';\n\n\tvar ListController;\n\tListController = function () {\n\t\tfunction ListController(_$scope, $rootScope, _$window, _$routeParams, _$listsmodel, _$tasksbusinesslayer, _$collectionsmodel, _$listsbusinesslayer, $location, _$searchbusinesslayer, _$calendarservice, _$tasksmodel, _$timeout) {\n\n\t\t\tthis._$scope = _$scope;\n\t\t\tthis._$window = _$window;\n\t\t\tthis._$routeParams = _$routeParams;\n\t\t\tthis._$listsmodel = _$listsmodel;\n\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\tthis._$tasksbusinesslayer = _$tasksbusinesslayer;\n\t\t\tthis._$collectionsmodel = _$collectionsmodel;\n\t\t\tthis._$listsbusinesslayer = _$listsbusinesslayer;\n\t\t\tthis.$location = $location;\n\t\t\tthis._$timeout = _$timeout;\n\t\t\tthis._$searchbusinesslayer = _$searchbusinesslayer;\n\t\t\tthis._$calendarservice = _$calendarservice;\n\t\t\tthis._$scope.collections = this._$collectionsmodel.getAll();\n\t\t\tthis._$scope.calendars = this._$listsmodel.getAll();\n\t\t\tthis._$scope.draggedTasks = [];\n\t\t\tthis._$scope.TasksBusinessLayer = this._$tasksbusinesslayer;\n\t\t\tthis._$scope.nameError = false;\n\t\t\tthis._$scope.color = '#31CC7C';\n\n\t\t\tthis._$scope.deleteMessage = function (calendar) {\n\t\t\t\treturn t('tasks', 'This will delete the Calendar \"%s\" and all of its entries.').replace('%s', calendar.displayname);\n\t\t\t};\n\n\t\t\tthis._$scope[\"delete\"] = function (calendar) {\n\t\t\t\treturn _$listsbusinesslayer[\"delete\"](calendar).then(function () {\n\t\t\t\t\t$location.path('/calendars/' + _$listsmodel.getStandardList().uri);\n\t\t\t\t\treturn $scope.$apply();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis._$scope.startCreate = function () {\n\t\t\t\t_$scope.status.addingList = true;\n\t\t\t\t_$scope.nameError = false;\n\t\t\t\t$('.hasTooltip').tooltip('hide');\n\t\t\t\t_$timeout(function () {\n\t\t\t\t\t$('#newList').focus();\n\t\t\t\t}, 50);\n\t\t\t};\n\n\t\t\tthis._$scope.create = function () {\n\t\t\t\tvar check = _$scope.isNameAllowed(_$scope.status.newListName);\n\t\t\t\tif (check.allowed) {\n\t\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t\t_$scope.isAddingList = true;\n\t\t\t\t\t_$listsbusinesslayer.add(_$scope.status.newListName, _$scope.color).then(function (calendar) {\n\t\t\t\t\t\t$location.path('/calendars/' + calendar.uri);\n\t\t\t\t\t\treturn $scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t\t_$scope.status.newListName = '';\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.cancelCreate = function () {\n\t\t\t\t$('.hasTooltip').tooltip('hide');\n\t\t\t\t_$scope.nameError = false;\n\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t_$scope.status.newListName = \"\";\n\t\t\t};\n\n\t\t\tthis._$scope.startEdit = function (calendar) {\n\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t_$scope.nameError = false;\n\t\t\t\t$('.hasTooltip').tooltip('hide');\n\t\t\t\tcalendar.prepareUpdate();\n\t\t\t\t$location.path('/calendars/' + _$scope.route.calendarID + '/edit/name');\n\t\t\t\t_$timeout(function () {\n\t\t\t\t\t$('#list_' + calendar.uri + ' input.edit').focus();\n\t\t\t\t}, 50);\n\t\t\t};\n\n\t\t\tthis._$scope.showCalDAVUrl = function (calendar) {\n\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t_$scope.nameError = false;\n\t\t\t\t$location.path('/calendars/' + _$scope.route.calendarID + '/edit/caldav');\n\t\t\t\t_$timeout(function () {\n\t\t\t\t\t$('#list_' + calendar.uri + ' input.caldav').focus();\n\t\t\t\t}, 50);\n\t\t\t};\n\n\t\t\tthis._$scope.hideCalDAVUrl = function () {\n\t\t\t\t$location.path('/calendars/' + _$scope.route.calendarID);\n\t\t\t};\n\n\t\t\tthis._$scope.download = function (calendar) {\n\t\t\t\tvar url = calendar.url;\n\t\t\t\t// cut off last slash to have a fancy name for the ics\n\t\t\t\tif (url.slice(url.length - 1) === '/') {\n\t\t\t\t\turl = url.slice(0, url.length - 1);\n\t\t\t\t}\n\t\t\t\turl += '?export';\n\t\t\t\t$window.open(url);\n\t\t\t};\n\n\t\t\tthis._$scope.checkNew = function (event, name) {\n\t\t\t\t_$scope.checkName(event, name);\n\t\t\t};\n\n\t\t\tthis._$scope.checkEdit = function (event, calendar) {\n\t\t\t\t_$scope.checkName(event, calendar.displayname, calendar.uri);\n\t\t\t\tif (event.keyCode === 27) {\n\t\t\t\t\t_$scope.cancelEdit(calendar);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.checkName = function (event, name, uri) {\n\t\t\t\tvar check = _$scope.isNameAllowed(name, uri);\n\t\t\t\tvar $input = $(event.currentTarget);\n\t\t\t\tif (!check.allowed) {\n\t\t\t\t\t$input.attr('title', check.msg).tooltip({ placement: 'bottom', trigger: 'manual' }).tooltip('fixTitle').tooltip('show');\n\t\t\t\t\t_$scope.nameError = true;\n\t\t\t\t} else {\n\t\t\t\t\t$input.tooltip('hide');\n\t\t\t\t\t_$scope.nameError = false;\n\t\t\t\t}\n\t\t\t\tif (event.keyCode === 27) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t$input.tooltip('hide');\n\t\t\t\t\t_$scope.status.addingList = false;\n\t\t\t\t\t_$scope.status.newListName = \"\";\n\t\t\t\t\t_$scope.nameError = false;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$rootScope.$on('cancelEditCalendar', function (s, calendarUri) {\n\t\t\t\tvar calendar = _$listsmodel.getByUri(calendarUri);\n\t\t\t\t_$scope.cancelEdit(calendar);\n\t\t\t});\n\n\t\t\tthis._$scope.cancelEdit = function (calendar) {\n\t\t\t\tcalendar.resetToPreviousState();\n\t\t\t\t$('.hasTooltip').tooltip('hide');\n\t\t\t\t_$scope.nameError = false;\n\t\t\t\t$location.path('/calendars/' + _$scope.route.calendarID);\n\t\t\t};\n\n\t\t\tthis._$scope.saveEdit = function (calendar) {\n\t\t\t\tvar check = _$scope.isNameAllowed(calendar.displayname, calendar.uri);\n\t\t\t\tif (check.allowed) {\n\t\t\t\t\t_$listsbusinesslayer.rename(calendar);\n\t\t\t\t\t$location.path('/calendars/' + _$scope.route.calendarID);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.isNameAllowed = function (name, uri) {\n\t\t\t\tvar check = {\n\t\t\t\t\tallowed: false,\n\t\t\t\t\tmsg: ''\n\t\t\t\t};\n\t\t\t\tif (_$listsmodel.isNameAlreadyTaken(name, uri)) {\n\t\t\t\t\tcheck.msg = t('tasks', 'The name \"%s\" is already used.').replace('%s', name);\n\t\t\t\t} else if (!name) {\n\t\t\t\t\tcheck.msg = t('tasks', 'An empty name is not allowed.');\n\t\t\t\t} else {\n\t\t\t\t\tcheck.allowed = true;\n\t\t\t\t}\n\t\t\t\treturn check;\n\t\t\t};\n\n\t\t\tthis._$scope.getCollectionCount = function (collectionID) {\n\t\t\t\tvar filter;\n\t\t\t\tfilter = _$searchbusinesslayer.getFilter();\n\t\t\t\treturn _$collectionsmodel.getCount(collectionID, filter);\n\t\t\t};\n\n\t\t\tthis._$scope.hideCollection = function (collectionID) {\n\t\t\t\tvar collection;\n\t\t\t\tcollection = _$collectionsmodel.getById(collectionID);\n\t\t\t\tswitch (collection.show) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\treturn this.getCollectionCount(collectionID) < 1;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.getCollectionString = function (collectionID) {\n\t\t\t\tvar filter;\n\t\t\t\tif (collectionID !== 'completed') {\n\t\t\t\t\tfilter = _$searchbusinesslayer.getFilter();\n\t\t\t\t\treturn _$collectionsmodel.getCount(collectionID, filter);\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._$scope.getListCount = function (listID, type) {\n\t\t\t\tvar filter;\n\t\t\t\tfilter = _$searchbusinesslayer.getFilter();\n\t\t\t\treturn _$listsmodel.getCount(listID, type, filter);\n\t\t\t};\n\n\t\t\tthis._$scope.dragoverList = function ($event, index) {\n\t\t\t\tvar calendarID = $($event.target).closest('li.list').attr('calendarID');\n\t\t\t\tvar calendar = _$listsmodel.getByUri(calendarID);\n\t\t\t\treturn calendar.writable;\n\t\t\t};\n\n\t\t\tthis._$scope.dropList = function ($event, index, item) {\n\t\t\t\tif ($event.dataTransfer.dropEffect === 'move') {\n\t\t\t\t\t// we can't simply use item as task, since the directive seems to not copy all properties --> task.calendar.uri == undefined\n\t\t\t\t\tvar task = _$tasksmodel.getByUri(item.uri);\n\t\t\t\t\tvar calendarID = $($event.target).closest('li.list').attr('calendarID');\n\t\t\t\t\tvar calendar = _$listsmodel.getByUri(calendarID);\n\t\t\t\t\t_$tasksbusinesslayer.changeCalendar(task, calendar).then(function () {\n\t\t\t\t\t\t_$scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tthis._$scope.dragoverCollection = function ($event, index) {\n\t\t\t\tif ($event.dataTransfer.effectAllowed === 'copy' || $event.dataTransfer.effectAllowed === 'copyMove' && $event.ctrlKey) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvar collectionID;\n\t\t\t\tcollectionID = $($event.target).closest('li.collection').attr('collectionID');\n\t\t\t\treturn collectionID === 'starred' || collectionID === 'completed' || collectionID === 'today';\n\t\t\t};\n\n\t\t\tthis._$scope.dropCollection = function ($event, index, item) {\n\t\t\t\tif ($event.dataTransfer.dropEffect === 'move') {\n\t\t\t\t\tvar collectionID = $($event.target).closest('li.collection').attr('collectionID');\n\t\t\t\t\t_$tasksbusinesslayer.changeCollection(item.uri, collectionID);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\t\treturn ListController;\n\t}();\n\treturn new ListController($scope, $rootScope, $window, $routeParams, ListsModel, TasksBusinessLayer, CollectionsModel, ListsBusinessLayer, $location, SearchBusinessLayer, CalendarService, TasksModel, $timeout);\n}]);","'use strict';\n\nangular.module('Tasks').controller('SettingsController', ['$scope', '$window', 'Status', '$location', 'CollectionsModel', 'SettingsBusinessLayer', 'SettingsModel', function ($scope, $window, Status, $location, CollectionsModel, SettingsBusinessLayer, SettingsModel) {\n\t'use strict';\n\n\tvar SettingsController;\n\tSettingsController = function () {\n\t\tfunction SettingsController(_$scope, _$window, _$status, _$location, _$collectionsmodel, _$settingsbusinesslayer, _$settingsmodel) {\n\t\t\tvar _this = this;\n\t\t\tthis._$scope = _$scope;\n\t\t\tthis._$window = _$window;\n\t\t\tthis._$status = _$status;\n\t\t\tthis._$location = _$location;\n\t\t\tthis._$collectionsmodel = _$collectionsmodel;\n\t\t\tthis._$settingsbusinesslayer = _$settingsbusinesslayer;\n\t\t\tthis._$settingsmodel = _$settingsmodel;\n\t\t\tthis._$scope.status = this._$status.getStatus();\n\t\t\tthis._$scope.collections = this._$collectionsmodel.getAll();\n\t\t\tthis._$scope.settingsmodel = this._$settingsmodel;\n\t\t\tthis._$scope.collectionOptions = [{\n\t\t\t\tid: 0,\n\t\t\t\tname: t('tasks', 'Hidden')\n\t\t\t}, {\n\t\t\t\tid: 1,\n\t\t\t\tname: t('tasks', 'Visible')\n\t\t\t}, {\n\t\t\t\tid: 2,\n\t\t\t\tname: t('tasks', 'Automatic')\n\t\t\t}];\n\t\t\tthis._$scope.startOfWeekOptions = [{\n\t\t\t\tid: 0,\n\t\t\t\tname: t('tasks', 'Sunday')\n\t\t\t}, {\n\t\t\t\tid: 1,\n\t\t\t\tname: t('tasks', 'Monday')\n\t\t\t}, {\n\t\t\t\tid: 2,\n\t\t\t\tname: t('tasks', 'Tuesday')\n\t\t\t}, {\n\t\t\t\tid: 3,\n\t\t\t\tname: t('tasks', 'Wednesday')\n\t\t\t}, {\n\t\t\t\tid: 4,\n\t\t\t\tname: t('tasks', 'Thursday')\n\t\t\t}, {\n\t\t\t\tid: 5,\n\t\t\t\tname: t('tasks', 'Friday')\n\t\t\t}, {\n\t\t\t\tid: 6,\n\t\t\t\tname: t('tasks', 'Saturday')\n\t\t\t}];\n\t\t\tthis._$scope.setVisibility = function (collectionID) {\n\t\t\t\tvar collection;\n\t\t\t\tcollection = _$collectionsmodel.getById(collectionID);\n\t\t\t\treturn _$settingsbusinesslayer.setVisibility(collectionID, collection.show);\n\t\t\t};\n\t\t\tthis._$scope.setStartOfWeek = function () {\n\t\t\t\treturn _$settingsbusinesslayer.set('various', 'startOfWeek', _$settingsmodel.getById('various').startOfWeek);\n\t\t\t};\n\t\t}\n\n\t\treturn SettingsController;\n\t}();\n\treturn new SettingsController($scope, $window, Status, $location, CollectionsModel, SettingsBusinessLayer, SettingsModel);\n}]);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __indexOf = [].indexOf || function (item) {\n\t\tfor (var i = 0, l = this.length; i < l; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\tangular.module('Tasks').controller('TasksController', ['$scope', '$window', '$routeParams', 'TasksModel', 'ListsModel', 'CollectionsModel', 'TasksBusinessLayer', '$location', 'SettingsBusinessLayer', 'SearchBusinessLayer', 'VTodo', 'SettingsModel', function ($scope, $window, $routeParams, TasksModel, ListsModel, CollectionsModel, TasksBusinessLayer, $location, SettingsBusinessLayer, SearchBusinessLayer, VTodo, SettingsModel) {\n\t\tvar TasksController;\n\t\tTasksController = function () {\n\t\t\tfunction TasksController(_$scope, _$window, _$routeParams, _$tasksmodel, _$listsmodel, _$collectionsmodel, _tasksbusinesslayer, $location, _settingsbusinesslayer, _searchbusinesslayer, vtodo, _$settingsmodel) {\n\t\t\t\tvar _this = this;\n\t\t\t\tthis._$scope = _$scope;\n\t\t\t\tthis._$window = _$window;\n\t\t\t\tthis._$routeParams = _$routeParams;\n\t\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\t\tthis._$listsmodel = _$listsmodel;\n\t\t\t\tthis._$collectionsmodel = _$collectionsmodel;\n\t\t\t\tthis._tasksbusinesslayer = _tasksbusinesslayer;\n\t\t\t\tthis.$location = $location;\n\t\t\t\tthis._settingsbusinesslayer = _settingsbusinesslayer;\n\t\t\t\tthis._searchbusinesslayer = _searchbusinesslayer;\n\t\t\t\tthis._vtodo = vtodo;\n\t\t\t\tthis._$scope.tasks = this._$tasksmodel.getAll();\n\t\t\t\tthis._$scope.draggedTasks = [];\n\t\t\t\tthis._$scope.calendars = this._$listsmodel.getAll();\n\t\t\t\tthis._$scope.days = [0, 1, 2, 3, 4, 5, 6];\n\t\t\t\tthis._$scope.isAddingTask = false;\n\t\t\t\tthis._$scope.focusInputField = false;\n\t\t\t\tthis._$scope.TasksModel = this._$tasksmodel;\n\t\t\t\tthis._$scope.TasksBusinessLayer = this._tasksbusinesslayer;\n\t\t\t\tthis._$settingsmodel = _$settingsmodel;\n\n\t\t\t\tthis._$scope.addTask = function (taskName, related, calendar, parent) {\n\t\t\t\t\tvar _ref,\n\t\t\t\t\t    _this = this;\n\t\t\t\t\tif (calendar === null) {\n\t\t\t\t\t\tcalendar = '';\n\t\t\t\t\t}\n\t\t\t\t\t_$scope.isAddingTask = true;\n\t\t\t\t\tvar task = {\n\t\t\t\t\t\tcalendar: null,\n\t\t\t\t\t\trelated: related,\n\t\t\t\t\t\tsummary: taskName,\n\t\t\t\t\t\tpriority: '0',\n\t\t\t\t\t\tdue: false,\n\t\t\t\t\t\tstart: false,\n\t\t\t\t\t\treminder: null,\n\t\t\t\t\t\tcompleted: false,\n\t\t\t\t\t\tcomplete: '0',\n\t\t\t\t\t\tnote: ''\n\t\t\t\t\t};\n\t\t\t\t\tif ((_ref = _$scope.route.collectionID) === 'starred' || _ref === 'today' || _ref === 'week' || _ref === 'all' || _ref === 'completed' || _ref === 'current') {\n\t\t\t\t\t\tif (related) {\n\t\t\t\t\t\t\ttask.calendar = calendar;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttask.calendar = _$listsmodel.getStandardList();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (_$scope.route.collectionID === 'starred') {\n\t\t\t\t\t\t\ttask.priority = '1';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (_$scope.route.collectionID === 'today') {\n\t\t\t\t\t\t\ttask.due = moment().startOf('day').format(\"YYYY-MM-DDTHH:mm:ss\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (_$scope.route.collectionID === 'current') {\n\t\t\t\t\t\t\ttask.start = moment().format(\"YYYY-MM-DDTHH:mm:ss\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttask.calendar = _$listsmodel.getByUri(_$scope.route.calendarID);\n\t\t\t\t\t}\n\t\t\t\t\ttask = VTodo.create(task);\n\t\t\t\t\t_tasksbusinesslayer.add(task).then(function (task) {\n\t\t\t\t\t\t_$scope.isAddingTask = false;\n\t\t\t\t\t\t_$scope.openDetails(task.uri, null);\n\t\t\t\t\t\treturn $scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\t_tasksbusinesslayer.setHideSubtasks(parent, 0);\n\t\t\t\t\t}\n\t\t\t\t\t_$scope.status.focusTaskInput = false;\n\t\t\t\t\t_$scope.status.focusSubtaskInput = false;\n\t\t\t\t\t_$scope.status.addSubtaskTo = null;\n\t\t\t\t\t_$scope.status.taskName = '';\n\t\t\t\t\t_$scope.status.subtaskName = '';\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getAddString = function () {\n\t\t\t\t\tvar calendar = _$listsmodel.getStandardList();\n\t\t\t\t\tif (angular.isDefined(calendar)) {\n\t\t\t\t\t\tif (angular.isDefined(_$scope.route.collectionID)) {\n\t\t\t\t\t\t\tswitch (_$scope.route.collectionID) {\n\t\t\t\t\t\t\t\tcase 'starred':\n\t\t\t\t\t\t\t\t\treturn t('tasks', 'Add an important item in \"%s\"...').replace('%s', calendar.displayname);\n\t\t\t\t\t\t\t\tcase 'today':\n\t\t\t\t\t\t\t\t\treturn t('tasks', 'Add an item due today in \"%s\"...').replace('%s', calendar.displayname);\n\t\t\t\t\t\t\t\tcase 'all':\n\t\t\t\t\t\t\t\t\treturn t('tasks', 'Add an item in \"%s\"...').replace('%s', calendar.displayname);\n\t\t\t\t\t\t\t\tcase 'current':\n\t\t\t\t\t\t\t\t\treturn t('tasks', 'Add a current item in \"%s\"...').replace('%s', calendar.displayname);\n\t\t\t\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\t\t\tcase 'week':\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (angular.isDefined(_$listsmodel.getByUri(_$scope.route.calendarID))) {\n\t\t\t\t\t\t\t\treturn t('tasks', 'Add an item in \"%s\"...').replace('%s', _$listsmodel.getByUri(_$scope.route.calendarID).displayname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getSubAddString = function (taskname) {\n\t\t\t\t\treturn t('tasks', 'Add a subtask to \"%s\"...').replace('%s', taskname);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.showSubtaskInput = function (uid) {\n\t\t\t\t\t_$scope.status.addSubtaskTo = uid;\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.hideSubtasks = function (task) {\n\t\t\t\t\tvar taskID = _$scope.route.taskID;\n\t\t\t\t\tvar descendantIDs = _$tasksmodel.getDescendantIDs(task);\n\t\t\t\t\tif (task.uri === taskID) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else if (__indexOf.call(descendantIDs, taskID) >= 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn task.hideSubtasks;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.showInput = function () {\n\t\t\t\t\tvar collectionID = _$scope.route.collectionID;\n\t\t\t\t\tvar calendar = _$listsmodel.getByUri(_$scope.route.calendarID);\n\t\t\t\t\tif (collectionID === 'completed' || collectionID === 'week') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (angular.isDefined(calendar)) {\n\t\t\t\t\t\treturn calendar.writable;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.focusTaskInput = function () {\n\t\t\t\t\t_$scope.status.focusTaskInput = true;\n\t\t\t\t};\n\t\t\t\tthis._$scope.focusSubtaskInput = function () {\n\t\t\t\t\t_$scope.status.focusSubtaskInput = true;\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.openDetails = function (id, $event) {\n\t\t\t\t\tvar calendarID = _$scope.route.calendarID;\n\t\t\t\t\tvar collectionID = _$scope.route.collectionID;\n\t\t\t\t\tif ($event === null || $($event.currentTarget).is($($event.target).closest('.handler'))) {\n\t\t\t\t\t\tvar parent = _$tasksmodel.getByUri(id);\n\t\t\t\t\t\tif (!parent.loadedCompleted) {\n\t\t\t\t\t\t\t_tasksbusinesslayer.getAll(parent.calendar, true, parent).then(function () {\n\t\t\t\t\t\t\t\tparent.loadedCompleted = true;\n\t\t\t\t\t\t\t\t$scope.$apply();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (calendarID) {\n\t\t\t\t\t\t\t$location.path('/calendars/' + calendarID + '/tasks/' + id);\n\t\t\t\t\t\t} else if (collectionID) {\n\t\t\t\t\t\t\t$location.path('/collections/' + collectionID + '/tasks/' + id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.toggleCompleted = function (task) {\n\t\t\t\t\tif (task.completed) {\n\t\t\t\t\t\t_tasksbusinesslayer.setPercentComplete(task, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_tasksbusinesslayer.setPercentComplete(task, 100);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.toggleStarred = function (task) {\n\t\t\t\t\tif (task.priority > 5) {\n\t\t\t\t\t\t_tasksbusinesslayer.setPriority(task, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_tasksbusinesslayer.setPriority(task, 9);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.toggleHidden = function () {\n\t\t\t\t\treturn _settingsbusinesslayer.toggle('various', 'showHidden');\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.filterTasks = function (task, filter) {\n\t\t\t\t\treturn function (task) {\n\t\t\t\t\t\treturn _$tasksmodel.filterTasks(task, filter);\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getSubTasks = function (tasks, parent) {\n\t\t\t\t\tvar ret, task, _i, _len;\n\t\t\t\t\tret = [];\n\t\t\t\t\tfor (_i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\t\tif (task.related === parent.uid && task !== parent && !(parent.hideCompletedSubtasks && task.completed)) {\n\t\t\t\t\t\t\tret.push(task);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.hasNoParent = function (task) {\n\t\t\t\t\treturn function (task) {\n\t\t\t\t\t\treturn _$tasksmodel.hasNoParent(task);\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.hasSubtasks = function (task) {\n\t\t\t\t\treturn _$tasksmodel.hasSubtasks(task.uid);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.hasCompletedSubtasks = function (task) {\n\t\t\t\t\treturn _$tasksmodel.hasCompletedSubtasks(task.uid);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.toggleSubtasks = function (task) {\n\t\t\t\t\t_tasksbusinesslayer.setHideSubtasks(task, !task.hideSubtasks);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.toggleCompletedSubtasks = function (task) {\n\t\t\t\t\t_tasksbusinesslayer.setHideCompletedSubtasks(task, !task.hideCompletedSubtasks);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.filterTasksByString = function (task) {\n\t\t\t\t\treturn function (task) {\n\t\t\t\t\t\tvar filter = _searchbusinesslayer.getFilter();\n\t\t\t\t\t\treturn _$tasksmodel.filterTasksByString(task, filter);\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.filteredTasks = function () {\n\t\t\t\t\tvar filter;\n\t\t\t\t\tfilter = _searchbusinesslayer.getFilter();\n\t\t\t\t\treturn _$tasksmodel.filteredTasks(filter);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dayHasEntry = function () {\n\t\t\t\t\treturn function (date) {\n\t\t\t\t\t\tvar filter, task, tasks, _i, _len;\n\t\t\t\t\t\tfilter = _searchbusinesslayer.getFilter();\n\t\t\t\t\t\ttasks = _$tasksmodel.filteredTasks(filter);\n\t\t\t\t\t\tfor (_i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\t\t\tif (task.completed || !_$tasksmodel.hasNoParent(task)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (_$tasksmodel.taskAtDay(task, date)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tthis._$scope.taskAtDay = function (task, day) {\n\t\t\t\t\treturn function (task) {\n\t\t\t\t\t\treturn _$tasksmodel.taskAtDay(task, day);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tthis._$scope.filterLists = function () {\n\t\t\t\t\treturn function (calendar) {\n\t\t\t\t\t\treturn _$scope.getCount(calendar.uri, _$scope.route.collectionID);\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getCount = function (calendarID, type) {\n\t\t\t\t\tvar filter = _searchbusinesslayer.getFilter();\n\t\t\t\t\treturn _$listsmodel.getCount(calendarID, type, filter);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getCountString = function (calendarID, type) {\n\t\t\t\t\tvar filter = _searchbusinesslayer.getFilter();\n\t\t\t\t\treturn n('tasks', '%n Completed Task', '%n Completed Tasks', _$listsmodel.getCount(calendarID, type, filter));\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.checkTaskInput = function ($event) {\n\t\t\t\t\tif ($event.keyCode === 27) {\n\t\t\t\t\t\t$($event.currentTarget).blur();\n\t\t\t\t\t\t_$scope.status.taskName = '';\n\t\t\t\t\t\t_$scope.status.subtaskName = '';\n\t\t\t\t\t\t_$scope.status.addSubtaskTo = null;\n\t\t\t\t\t\t_$scope.status.focusTaskInput = false;\n\t\t\t\t\t\t_$scope.status.focusSubtaskInput = false;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getCompletedTasks = function (calendarID) {\n\t\t\t\t\tvar calendar = _$listsmodel.getById(calendarID);\n\t\t\t\t\t_tasksbusinesslayer.getAll(calendar, true).then(function () {\n\t\t\t\t\t\t_$listsmodel.setLoadedCompleted(calendarID);\n\t\t\t\t\t\t$scope.$apply();\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.loadedCompleted = function (calendarID) {\n\t\t\t\t\treturn _$listsmodel.loadedCompleted(calendarID);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.sortDue = function (task) {\n\t\t\t\t\tif (task.due === null) {\n\t\t\t\t\t\treturn 'last';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn task.due;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.sortStart = function (task) {\n\t\t\t\t\tif (task.start === null) {\n\t\t\t\t\t\treturn 'last';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn task.start;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getSortOrder = function () {\n\t\t\t\t\tswitch (_$scope.settingsmodel.getById('various').sortOrder) {\n\t\t\t\t\t\tcase 'due':\n\t\t\t\t\t\t\treturn _$scope.sortDue;\n\t\t\t\t\t\tcase 'start':\n\t\t\t\t\t\t\treturn _$scope.sortStart;\n\t\t\t\t\t\tcase 'priority':\n\t\t\t\t\t\t\treturn '-priority';\n\t\t\t\t\t\tcase 'alphabetically':\n\t\t\t\t\t\t\treturn 'summary';\n\t\t\t\t\t\tcase 'manual':\n\t\t\t\t\t\t\treturn 'manual';\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn ['completed', _$scope.sortDue, '-priority', _$scope.sortStart, 'summary'];\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.getSortOrderIcon = function () {\n\t\t\t\t\tswitch (_$scope.settingsmodel.getById('various').sortOrder) {\n\t\t\t\t\t\tcase 'due':\n\t\t\t\t\t\tcase 'start':\n\t\t\t\t\t\t\treturn 'ico-calendar';\n\t\t\t\t\t\tcase 'priority':\n\t\t\t\t\t\t\treturn 'ico-star';\n\t\t\t\t\t\tcase 'alphabetically':\n\t\t\t\t\t\t\treturn 'ico-alphabetically';\n\t\t\t\t\t\tcase 'manual':\n\t\t\t\t\t\t\treturn 'ico-manual';\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn 'ico-menu';\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.setSortOrder = function ($event, order) {\n\t\t\t\t\t_$scope.settingsmodel.getById('various').sortDirection = _$scope.settingsmodel.getById('various').sortOrder === order ? +!_$scope.settingsmodel.getById('various').sortDirection : 0;\n\t\t\t\t\t_$scope.settingsmodel.getById('various').sortOrder = order;\n\t\t\t\t\t_settingsbusinesslayer.set('various', 'sortOrder', order);\n\t\t\t\t\t_settingsbusinesslayer.set('various', 'sortDirection', _$scope.settingsmodel.getById('various').sortDirection);\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dropAsSubtask = function ($event, item, index) {\n\t\t\t\t\tif ($event.dataTransfer.dropEffect === 'move') {\n\t\t\t\t\t\tvar parentID = $($event.target).closest('.task-item').attr('taskID');\n\t\t\t\t\t\tvar task = _$tasksmodel.getByUri(item.uri);\n\t\t\t\t\t\tvar parent = _$tasksmodel.getByUri(parentID);\n\t\t\t\t\t\t_tasksbusinesslayer.changeParent(task, parent);\n\t\t\t\t\t}\n\t\t\t\t\t$('.subtasks-container').removeClass('dropzone-visible');\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dropAsRootTask = function ($event, item, index) {\n\t\t\t\t\tif ($event.dataTransfer.dropEffect === 'move') {\n\t\t\t\t\t\tvar task = _$tasksmodel.getByUri(item.uri);\n\t\t\t\t\t\tvar collectionID = $($event.target).closest('ol[dnd-list]').attr('collectionID');\n\t\t\t\t\t\tvar calendarID = $($event.target).closest('ol[dnd-list]').attr('calendarID');\n\t\t\t\t\t\tvar newCalendar = _$listsmodel.getByUri(calendarID);\n\t\t\t\t\t\tvar queries = _tasksbusinesslayer.makeRootTask(task, newCalendar, collectionID);\n\t\t\t\t\t\tPromise.all(queries).then(function () {\n\t\t\t\t\t\t\t$scope.$apply();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t$('.subtasks-container').removeClass('dropzone-visible');\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dragover = function ($event, item, index) {\n\t\t\t\t\t$('.subtasks-container').removeClass('dropzone-visible');\n\t\t\t\t\tvar calendarID = $($event.target).closest('ol[dnd-list]').attr('calendarID');\n\t\t\t\t\tvar calendar = _$listsmodel.getByUri(calendarID);\n\t\t\t\t\tif (calendar.writable) {\n\t\t\t\t\t\t$($event.target).closest('.task-item').children('.subtasks-container').addClass('dropzone-visible');\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.allow = function (task) {\n\t\t\t\t\tif (task.calendar.writable) {\n\t\t\t\t\t\treturn \"copyMove\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"copy\";\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dragStart = function ($event) {\n\t\t\t\t\tif ($event.dataTransfer.effectAllowed === 'copy' || $event.dataTransfer.effectAllowed === 'copyMove' && $event.ctrlKey) {\n\t\t\t\t\t\t$($event.target).addClass('copy');\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis._$scope.dragEnd = function ($event) {\n\t\t\t\t\t$($event.target).removeClass('copy');\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn TasksController;\n\t\t}();\n\t\treturn new TasksController($scope, $window, $routeParams, TasksModel, ListsModel, CollectionsModel, TasksBusinessLayer, $location, SettingsBusinessLayer, SearchBusinessLayer, VTodo, SettingsModel);\n\t}]);\n}).call(undefined);","'use strict';\n\nangular.module('Tasks').directive('appNavigationEntryUtils', function () {\n  'use strict';\n\n  return {\n    restrict: 'C',\n    link: function link(scope, elm) {\n      var button, menu;\n      menu = elm.siblings('.app-navigation-entry-menu');\n      button = $(elm).find('.app-navigation-entry-utils-menu-button button');\n      button.click(function () {\n        menu.toggleClass('open');\n      });\n      scope.$on('documentClicked', function (scope, event) {\n        if (event.target !== button[0]) {\n          menu.removeClass('open');\n        }\n      });\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').directive('autofocusOnInsert', function () {\n  'use strict';\n\n  return function (scope, elm) {\n    return elm.focus();\n  };\n});","'use strict';\n\nangular.module('Tasks').directive('avatar', function () {\n  'use strict';\n\n  return {\n    restrict: 'A',\n    scope: false,\n    link: function link(scope, elm, attr) {\n      return attr.$observe('userid', function () {\n        if (attr.userid) {\n          return elm.avatar(attr.userid, attr.size);\n        }\n      });\n    }\n  };\n});","'use strict';\n\nvar hslToRgb = function hslToRgb(hue, saturation, lightness) {\n\t'use strict';\n\t// based on algorithm from http://en.wikipedia.org/wiki/HSL_and_HSV#Converting_to_RGB\n\n\tif (Array.isArray(hue)) {\n\t\tsaturation = hue[1];\n\t\tlightness = hue[2];\n\t\thue = hue[0];\n\t}\n\tif (hue === undefined) {\n\t\treturn [0, 0, 0];\n\t}\n\tsaturation /= 100;\n\tlightness /= 100;\n\n\tvar chroma = (1 - Math.abs(2 * lightness - 1)) * saturation;\n\tvar huePrime = hue / 60;\n\tvar secondComponent = chroma * (1 - Math.abs(huePrime % 2 - 1));\n\n\thuePrime = Math.floor(huePrime);\n\tvar red;\n\tvar green;\n\tvar blue;\n\n\tif (huePrime === 0) {\n\t\tred = chroma;\n\t\tgreen = secondComponent;\n\t\tblue = 0;\n\t} else if (huePrime === 1) {\n\t\tred = secondComponent;\n\t\tgreen = chroma;\n\t\tblue = 0;\n\t} else if (huePrime === 2) {\n\t\tred = 0;\n\t\tgreen = chroma;\n\t\tblue = secondComponent;\n\t} else if (huePrime === 3) {\n\t\tred = 0;\n\t\tgreen = secondComponent;\n\t\tblue = chroma;\n\t} else if (huePrime === 4) {\n\t\tred = secondComponent;\n\t\tgreen = 0;\n\t\tblue = chroma;\n\t} else if (huePrime === 5) {\n\t\tred = chroma;\n\t\tgreen = 0;\n\t\tblue = secondComponent;\n\t}\n\n\tvar lightnessAdjustment = lightness - chroma / 2;\n\tred += lightnessAdjustment;\n\tgreen += lightnessAdjustment;\n\tblue += lightnessAdjustment;\n\n\treturn [Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255)];\n};\n\nvar rgbToHex = function rgbToHex(r, g, b) {\n\t'use strict';\n\n\tif (Array.isArray(r)) {\n\t\tg = r[1];\n\t\tb = r[2];\n\t\tr = r[0];\n\t}\n\treturn '#' + parseInt(r, 10).toString(16) + parseInt(g, 10).toString(16) + parseInt(b, 10).toString(16);\n};\n\nvar listofcolours = ['#31CC7C', '#317CCC', '#FF7A66', '#F1DB50', '#7C31CC', '#CC317C', '#3A3B3D', '#CACBCD'];\n\nvar randColour = function randColour() {\n\t'use strict';\n\n\tif (typeof String.prototype.toHsl === 'function') {\n\t\treturn rgbToHex(hslToRgb(Math.random().toString().toHsl()));\n\t} else {\n\t\treturn listofcolours[Math.floor(Math.random() * listofcolours.length)];\n\t}\n};\n\nangular.module('Tasks').directive('colorpicker', function () {\n\t'use strict';\n\n\tif (typeof String.prototype.toHsl === 'function') {\n\t\tvar hsl = \"\";\n\t\tvar hslcolour = \"\";\n\t\t//\t\t  0    40   80   120  160  200   240  280  320\n\t\tlistofcolours = [\"15\", \"9\", \"4\", \"b\", \"6\", \"11\", \"74\", \"f\", \"57\"];\n\t\tlistofcolours.forEach(function (hash, index) {\n\t\t\thsl = hash.toHsl();\n\t\t\thslcolour = hslToRgb(hsl);\n\t\t\tlistofcolours[index] = rgbToHex(hslcolour);\n\t\t});\n\t}\n\treturn {\n\t\tscope: {\n\t\t\tselected: '=',\n\t\t\tcustomizedColors: '=colors'\n\t\t},\n\t\trestrict: 'AE',\n\t\ttemplateUrl: OC.filePath('tasks', 'templates', 'colorpicker.html'),\n\t\tlink: function link(scope, element, attr) {\n\t\t\tscope.colors = scope.customizedColors || listofcolours;\n\t\t\tscope.selected = scope.selected || scope.colors[0];\n\t\t\tscope.random = \"#000000\";\n\n\t\t\tscope.randomizeColour = function () {\n\t\t\t\tscope.random = randColour();\n\t\t\t\tscope.pick(scope.random);\n\t\t\t};\n\n\t\t\tscope.pick = function (color) {\n\t\t\t\tscope.selected = color;\n\t\t\t};\n\t\t}\n\t};\n});","'use strict';\n\nangular.module('Tasks').directive('confirmation', function () {\n\t'use strict';\n\n\treturn {\n\t\tpriority: -1,\n\t\trestrict: 'A',\n\t\ttemplateUrl: OC.generateUrl('/apps/tasks/templates/confirmation', {}),\n\t\tscope: {\n\t\t\tconfirmationFunction: \"&confirmation\",\n\t\t\tconfirmationMessage: \"&confirmationMessage\"\n\n\t\t},\n\t\tcontroller: 'ConfirmationController'\n\t};\n});\n\nangular.module('Tasks').controller('ConfirmationController', ['$scope', '$rootScope', '$element', '$attrs', '$compile', '$document', '$window', '$timeout', function ($scope, $rootScope, $element, $attrs, $compile, $document, $window, $timeout) {\n\t'use strict';\n\n\tvar ConfirmationController = function () {\n\t\tfunction ConfirmationController(_$scope, $rootScope, $element, $attrs, $compile, $document, $window, $timeout) {\n\t\t\tthis._$scope = _$scope;\n\t\t\tthis._$scope.countdown = 3;\n\n\t\t\t$element.bind('click', function (e) {\n\t\t\t\t_$scope.countdown = 3;\n\t\t\t\t$element.removeClass('active');\n\t\t\t\tvar message = _$scope.confirmationMessage() ? _$scope.confirmationMessage() : \"Are you sure?\";\n\t\t\t\tif ($element.hasClass('confirmed')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t\t_$scope.activate();\n\t\t\t\t$element.children('.confirmation-confirm').tooltip({ title: message, container: 'body', placement: 'right' });\n\t\t\t\t$element.addClass(\"confirmed\");\n\t\t\t});\n\n\t\t\t$element.children('.confirmation-confirm').bind('click', function (e) {\n\t\t\t\tif ($element.hasClass('confirmed active')) {\n\t\t\t\t\t_$scope.confirmationFunction();\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._$scope.documentClick = function () {\n\t\t\t\t$element.removeClass(\"confirmed\");\n\t\t\t};\n\n\t\t\tthis._$scope.activate = function () {\n\t\t\t\tif (_$scope.countdown) {\n\t\t\t\t\t$element.find('.countdown').html(_$scope.countdown + ' s');\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t_$scope.activate();\n\t\t\t\t\t}, 1000);\n\t\t\t\t\t_$scope.countdown--;\n\t\t\t\t} else {\n\t\t\t\t\t$element.addClass('active');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$document.bind('click', _$scope.documentClick);\n\t\t\t$document.bind('touchend', _$scope.documentClick);\n\n\t\t\t$scope.$on('$destroy', function () {\n\t\t\t\t$document.unbind('click', _$scope.documentClick);\n\t\t\t\t$document.unbind('touchend', _$scope.documentClick);\n\t\t\t});\n\t\t}\n\t\treturn ConfirmationController;\n\t}();\n\treturn new ConfirmationController($scope, $rootScope, $element, $attrs, $compile, $document, $window, $timeout);\n}]);","'use strict';\n\nangular.module('Tasks').directive('datepicker', function () {\n\t'use strict';\n\n\treturn {\n\t\trestrict: 'A',\n\t\tscope: false,\n\t\tlink: function link(scope, elm, attr) {\n\t\t\treturn elm.datepicker({\n\t\t\t\tonSelect: function onSelect(date, inst) {\n\t\t\t\t\tscope['set' + attr.datepicker + 'day'](date);\n\t\t\t\t\treturn scope.$apply();\n\t\t\t\t},\n\t\t\t\tbeforeShow: function beforeShow(input, inst) {\n\t\t\t\t\tvar dp, marginLeft;\n\t\t\t\t\tdp = $(inst).datepicker('widget');\n\t\t\t\t\tmarginLeft = -Math.abs($(input).outerWidth() - dp.outerWidth()) / 2 + 'px';\n\t\t\t\t\tdp.css({\n\t\t\t\t\t\t'margin-left': marginLeft\n\t\t\t\t\t});\n\t\t\t\t\t$(\"div.ui-datepicker:before\").css({\n\t\t\t\t\t\t'left': 100 + 'px'\n\t\t\t\t\t});\n\t\t\t\t\treturn $('.hasDatepicker').datepicker(\"option\", \"firstDay\", scope.settingsmodel.getById('various').startOfWeek);\n\t\t\t\t},\n\t\t\t\tbeforeShowDay: function beforeShowDay(date) {\n\t\t\t\t\tif (moment(date).startOf('day').diff(moment(scope.task[attr.datepicker], \"YYYYMMDDTHHmmss\").startOf('day'), 'days') === 0) {\n\t\t\t\t\t\treturn [1, \"selected\"];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn [1, \"\"];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tminDate: null\n\t\t\t});\n\t\t}\n\t};\n});","'use strict';\n\nangular.module('Tasks').directive('ocClickFocus', ['$timeout', function ($timeout) {\n  'use strict';\n\n  return function (scope, elm, attr) {\n    var options;\n    options = scope.$eval(attr.ocClickFocus);\n    if (angular.isDefined(options) && angular.isDefined(options.selector)) {\n      return elm.click(function () {\n        if (angular.isDefined(options.timeout)) {\n          return $timeout(function () {\n            return $(options.selector).focus();\n          }, options.timeout);\n        } else {\n          return $(options.selector).focus();\n        }\n      });\n    }\n  };\n}]);","'use strict';\n\nangular.module('Tasks').directive('timepicker', function () {\n  'use strict';\n\n  return {\n    restrict: 'A',\n    link: function link(scope, elm, attr) {\n      return elm.timepicker({\n        onSelect: function onSelect(date, inst) {\n          scope['set' + attr.timepicker + 'time'](date);\n          return scope.$apply();\n        },\n        myPosition: 'center top',\n        atPosition: 'center bottom',\n        hourText: t('tasks', 'Hours'),\n        minuteText: t('tasks', 'Minutes')\n      });\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').directive('watchTop', function () {\n  'use strict';\n\n  return {\n    restrict: 'A',\n    link: function link(scope, element, attr) {\n      return scope.$watch(function () {\n        scope.divTop = element.prev().outerHeight(true);\n      });\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('counterFormatter', function () {\n  'use strict';\n\n  return function (count) {\n    switch (false) {\n      case count !== 0:\n        return '';\n      case count < 999:\n        return '999+';\n      default:\n        return count;\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('dateDetails', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").locale(due.isDate ? 'details_allday' : 'details').calendar();\n    } else {\n      return t('tasks', 'Set due date');\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('dateDetailsShort', function () {\n  'use strict';\n\n  return function (reminder) {\n    if (moment(reminder, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(reminder, \"YYYYMMDDTHHmmss\").locale('details_short').calendar();\n    } else {\n      return '';\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('dateFromNow', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").fromNow();\n    } else {\n      return '';\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('dateTaskList', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").locale('tasks').calendar();\n    } else {\n      return '';\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('day', function () {\n  'use strict';\n\n  return function (i) {\n    return moment().add('days', i).locale('list_week').calendar();\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('dayTaskList', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").locale('tasks').calendar();\n    } else {\n      return '';\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('percentDetails', function () {\n  'use strict';\n\n  return function (percent) {\n    return t('tasks', '%s %% completed').replace('%s', percent).replace('%%', '%');\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('priorityDetails', function () {\n  'use strict';\n\n  return function (priority) {\n    var string;\n    string = t('tasks', 'priority %s: ').replace('%s', priority);\n    if (+priority === 6 || +priority === 7 || +priority === 8 || +priority === 9) {\n      return string + ' ' + t('tasks', 'high');\n    } else if (+priority === 5) {\n      return string + ' ' + t('tasks', 'medium');\n    } else if (+priority === 1 || +priority === 2 || +priority === 3 || +priority === 4) {\n      return string + ' ' + t('tasks', 'low');\n    } else {\n      return t('tasks', 'no priority assigned');\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('reminderDetails', function () {\n\t'use strict';\n\n\treturn function (reminder, scope) {\n\t\tfunction before(related) {\n\t\t\tif (related === 'END') {\n\t\t\t\treturn ' ' + t('tasks', 'before end');\n\t\t\t} else {\n\t\t\t\treturn ' ' + t('tasks', 'before beginning');\n\t\t\t}\n\t\t}\n\t\tfunction after(related) {\n\t\t\tif (related === 'END') {\n\t\t\t\treturn ' ' + t('tasks', 'after end');\n\t\t\t} else {\n\t\t\t\treturn ' ' + t('tasks', 'after beginning');\n\t\t\t}\n\t\t}\n\t\tfunction tokenName(reminder, token) {\n\t\t\tif (+reminder.duration[token.id] === 1) {\n\t\t\t\treturn token.name;\n\t\t\t} else {\n\t\t\t\treturn token.names;\n\t\t\t}\n\t\t}\n\t\tvar ds, time, token, _ref;\n\t\tif (!(angular.isUndefined(reminder) || reminder === null)) {\n\t\t\tif (reminder.type === 'DATE-TIME' && moment(reminder.date, \"YYYYMMDDTHHmmss\").isValid()) {\n\t\t\t\treturn moment(reminder.date, \"YYYYMMDDTHHmmss\").locale('reminder').calendar();\n\t\t\t} else if (reminder.type === 'DURATION' && reminder.duration) {\n\t\t\t\tds = t('tasks', 'Remind me');\n\t\t\t\t_ref = scope.durations;\n\t\t\t\tfor (var _i = 0, _len = _ref.length; _i < _len; _i++) {\n\t\t\t\t\ttoken = _ref[_i];\n\t\t\t\t\tif (+reminder.duration[token.id]) {\n\t\t\t\t\t\ttime = 1;\n\t\t\t\t\t\tds += ' ' + reminder.duration[token.id] + ' ';\n\t\t\t\t\t\tds += tokenName(reminder, token);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!time) {\n\t\t\t\t\tif (reminder.duration.params.related === 'END') {\n\t\t\t\t\t\tds += ' ' + t('tasks', 'at the end');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tds += ' ' + t('tasks', 'at the beginning');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (reminder.duration.params.invert) {\n\t\t\t\t\t\tds += before(reminder.duration.params.related);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tds += after(reminder.duration.params.related);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn ds;\n\t\t\t} else {\n\t\t\t\treturn t('tasks', 'Remind me');\n\t\t\t}\n\t\t} else {\n\t\t\treturn t('tasks', 'Remind me');\n\t\t}\n\t};\n});","'use strict';\n\nangular.module('Tasks').filter('startDetails', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").locale(due.isDate ? 'start_allday' : 'start').calendar();\n    } else {\n      return t('tasks', 'Set start date');\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').filter('timeTaskList', function () {\n  'use strict';\n\n  return function (due) {\n    if (moment(due, \"YYYYMMDDTHHmmss\").isValid()) {\n      return moment(due, \"YYYYMMDDTHHmmss\").format('HH:mm');\n    } else {\n      return '';\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').service('CalendarService', ['DavClient', 'Calendar', function (DavClient, Calendar) {\n\t'use strict';\n\n\tvar _this = this;\n\n\tthis._CALENDAR_HOME = null;\n\n\tthis._currentUserPrincipal = null;\n\n\tthis._takenUrls = [];\n\n\tthis._PROPERTIES = ['{' + DavClient.NS_DAV + '}displayname', '{' + DavClient.NS_IETF + '}calendar-description', '{' + DavClient.NS_IETF + '}calendar-timezone', '{' + DavClient.NS_APPLE + '}calendar-order', '{' + DavClient.NS_APPLE + '}calendar-color', '{' + DavClient.NS_IETF + '}supported-calendar-component-set', '{' + DavClient.NS_OWNCLOUD + '}calendar-enabled', '{' + DavClient.NS_DAV + '}acl', '{' + DavClient.NS_DAV + '}owner', '{' + DavClient.NS_OWNCLOUD + '}invite'];\n\n\tfunction discoverHome(callback) {\n\t\treturn DavClient.propFind(DavClient.buildUrl(OC.linkToRemoteBase('dav')), ['{' + DavClient.NS_DAV + '}current-user-principal'], 0, { 'requesttoken': OC.requestToken }).then(function (response) {\n\t\t\tif (!DavClient.wasRequestSuccessful(response.status)) {\n\t\t\t\tthrow \"CalDAV client could not be initialized - Querying current-user-principal failed\";\n\t\t\t}\n\n\t\t\tif (response.body.propStat.length < 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar props = response.body.propStat[0].properties;\n\t\t\t_this._currentUserPrincipal = props['{' + DavClient.NS_DAV + '}current-user-principal'][0].textContent;\n\n\t\t\treturn DavClient.propFind(DavClient.buildUrl(_this._currentUserPrincipal), ['{' + DavClient.NS_IETF + '}calendar-home-set'], 0, { 'requesttoken': OC.requestToken }).then(function (response) {\n\t\t\t\tif (!DavClient.wasRequestSuccessful(response.status)) {\n\t\t\t\t\tthrow \"CalDAV client could not be initialized - Querying calendar-home-set failed\";\n\t\t\t\t}\n\n\t\t\t\tif (response.body.propStat.length < 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar props = response.body.propStat[0].properties;\n\t\t\t\t_this._CALENDAR_HOME = props['{' + DavClient.NS_IETF + '}calendar-home-set'][0].textContent;\n\n\t\t\t\treturn callback();\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction getResponseCodeFromHTTPResponse(t) {\n\t\treturn parseInt(t.split(' ')[1]);\n\t}\n\n\tthis.getAll = function () {\n\t\tif (this._CALENDAR_HOME === null) {\n\t\t\treturn discoverHome(function () {\n\t\t\t\treturn _this.getAll();\n\t\t\t});\n\t\t}\n\n\t\tvar prom = DavClient.propFind(DavClient.buildUrl(this._CALENDAR_HOME), this._PROPERTIES, 1, { 'requesttoken': OC.requestToken }).then(function (response) {\n\t\t\tvar calendars = [];\n\n\t\t\tif (!DavClient.wasRequestSuccessful(response.status)) {\n\t\t\t\tthrow \"CalDAV client could not be initialized - Querying calendars failed\";\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < response.body.length; i++) {\n\t\t\t\tvar body = response.body[i];\n\t\t\t\tif (body.propStat.length < 1) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t_this._takenUrls.push(body.href);\n\n\t\t\t\tvar responseCode = getResponseCodeFromHTTPResponse(body.propStat[0].status);\n\t\t\t\tif (!DavClient.wasRequestSuccessful(responseCode)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar doesSupportVTodo = false;\n\t\t\t\tvar components = body.propStat[0].properties['{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set'];\n\t\t\t\tif (components) {\n\t\t\t\t\tfor (var j = 0; j < components.length; j++) {\n\t\t\t\t\t\tvar name = components[j].attributes.getNamedItem('name').textContent.toLowerCase();\n\t\t\t\t\t\tif (name === 'vtodo') {\n\t\t\t\t\t\t\tdoesSupportVTodo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!doesSupportVTodo) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t_this._getACLFromResponse(body);\n\n\t\t\t\tvar uri = body.href.substr(_this._CALENDAR_HOME.length).replace(/[^\\w\\-]+/g, '');\n\n\t\t\t\tvar calendar = new Calendar(body.href, body.propStat[0].properties, uri);\n\t\t\t\tcalendars.push(calendar);\n\t\t\t}\n\n\t\t\treturn calendars;\n\t\t});\n\t\treturn prom;\n\t};\n\n\tthis.get = function (url) {\n\t\tif (this._CALENDAR_HOME === null) {\n\t\t\treturn discoverHome(function () {\n\t\t\t\treturn _this.get(url);\n\t\t\t});\n\t\t}\n\n\t\treturn DavClient.propFind(DavClient.buildUrl(url), this._PROPERTIES, 0, { 'requesttoken': OC.requestToken }).then(function (response) {\n\t\t\tvar body = response.body;\n\t\t\tif (body.propStat.length < 1) {\n\t\t\t\t//TODO - something went wrong\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar responseCode = getResponseCodeFromHTTPResponse(body.propStat[0].status);\n\t\t\tif (!DavClient.wasRequestSuccessful(responseCode)) {\n\t\t\t\t//TODO - something went wrong\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_this._getACLFromResponse(body);\n\n\t\t\tvar uri = body.href.substr(_this._CALENDAR_HOME.length).replace(/[^\\w\\-]+/g, '');\n\n\t\t\treturn new Calendar(body.href, body.propStat[0].properties, uri);\n\t\t});\n\t};\n\n\tthis.create = function (name, color, components) {\n\t\tif (this._CALENDAR_HOME === null) {\n\t\t\treturn discoverHome(function () {\n\t\t\t\treturn _this.create(name, color);\n\t\t\t});\n\t\t}\n\n\t\tif (typeof components === 'undefined') {\n\t\t\tcomponents = ['vtodo'];\n\t\t}\n\n\t\tvar xmlDoc = document.implementation.createDocument('', '', null);\n\t\tvar cMkcalendar = xmlDoc.createElement('c:mkcalendar');\n\t\tcMkcalendar.setAttribute('xmlns:c', 'urn:ietf:params:xml:ns:caldav');\n\t\tcMkcalendar.setAttribute('xmlns:d', 'DAV:');\n\t\tcMkcalendar.setAttribute('xmlns:a', 'http://apple.com/ns/ical/');\n\t\tcMkcalendar.setAttribute('xmlns:o', 'http://owncloud.org/ns');\n\t\txmlDoc.appendChild(cMkcalendar);\n\n\t\tvar dSet = xmlDoc.createElement('d:set');\n\t\tcMkcalendar.appendChild(dSet);\n\n\t\tvar dProp = xmlDoc.createElement('d:prop');\n\t\tdSet.appendChild(dProp);\n\n\t\tdProp.appendChild(this._createXMLForProperty(xmlDoc, 'displayname', name));\n\t\tdProp.appendChild(this._createXMLForProperty(xmlDoc, 'enabled', true));\n\t\tdProp.appendChild(this._createXMLForProperty(xmlDoc, 'color', color));\n\t\tdProp.appendChild(this._createXMLForProperty(xmlDoc, 'components', components));\n\n\t\tvar body = cMkcalendar.outerHTML;\n\n\t\tvar uri = this._suggestUri(name);\n\t\tvar url = this._CALENDAR_HOME + uri + '/';\n\t\tvar headers = {\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\n\t\treturn DavClient.request('MKCALENDAR', url, headers, body).then(function (response) {\n\t\t\tif (response.status === 201) {\n\t\t\t\t_this._takenUrls.push(url);\n\t\t\t\treturn _this.get(url).then(function (calendar) {\n\t\t\t\t\tcalendar.enabled = true;\n\t\t\t\t\treturn _this.update(calendar);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.update = function (calendar) {\n\t\tvar xmlDoc = document.implementation.createDocument('', '', null);\n\t\tvar dPropUpdate = xmlDoc.createElement('d:propertyupdate');\n\t\tdPropUpdate.setAttribute('xmlns:c', 'urn:ietf:params:xml:ns:caldav');\n\t\tdPropUpdate.setAttribute('xmlns:d', 'DAV:');\n\t\tdPropUpdate.setAttribute('xmlns:a', 'http://apple.com/ns/ical/');\n\t\tdPropUpdate.setAttribute('xmlns:o', 'http://owncloud.org/ns');\n\t\txmlDoc.appendChild(dPropUpdate);\n\n\t\tvar dSet = xmlDoc.createElement('d:set');\n\t\tdPropUpdate.appendChild(dSet);\n\n\t\tvar dProp = xmlDoc.createElement('d:prop');\n\t\tdSet.appendChild(dProp);\n\n\t\tvar updatedProperties = calendar.updatedProperties;\n\t\tcalendar.resetUpdatedProperties();\n\t\tfor (var i = 0; i < updatedProperties.length; i++) {\n\t\t\tdProp.appendChild(this._createXMLForProperty(xmlDoc, updatedProperties[i], calendar[updatedProperties[i]]));\n\t\t}\n\n\t\tvar url = calendar.url;\n\t\tvar body = dPropUpdate.outerHTML;\n\t\tvar headers = {\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\n\t\treturn DavClient.request('PROPPATCH', url, headers, body).then(function (response) {\n\t\t\treturn calendar;\n\t\t});\n\t};\n\n\tthis.delete = function (calendar) {\n\t\treturn DavClient.request('DELETE', calendar.url, { 'requesttoken': OC.requestToken }, '').then(function (response) {\n\t\t\tif (response.status === 204) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t// TODO - handle error case\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.share = function (calendar, shareType, shareWith, writable, existingShare) {\n\t\tvar xmlDoc = document.implementation.createDocument('', '', null);\n\t\tvar oShare = xmlDoc.createElement('o:share');\n\t\toShare.setAttribute('xmlns:d', 'DAV:');\n\t\toShare.setAttribute('xmlns:o', 'http://owncloud.org/ns');\n\t\txmlDoc.appendChild(oShare);\n\n\t\tvar oSet = xmlDoc.createElement('o:set');\n\t\toShare.appendChild(oSet);\n\n\t\tvar dHref = xmlDoc.createElement('d:href');\n\t\tif (shareType === OC.Share.SHARE_TYPE_USER) {\n\t\t\tdHref.textContent = 'principal:principals/users/';\n\t\t} else if (shareType === OC.Share.SHARE_TYPE_GROUP) {\n\t\t\tdHref.textContent = 'principal:principals/groups/';\n\t\t}\n\t\tdHref.textContent += shareWith;\n\t\toSet.appendChild(dHref);\n\n\t\tvar oSummary = xmlDoc.createElement('o:summary');\n\t\toSummary.textContent = t('calendar', '{calendar} shared by {owner}', {\n\t\t\tcalendar: calendar.displayname,\n\t\t\towner: calendar.owner\n\t\t});\n\t\toSet.appendChild(oSummary);\n\n\t\tif (writable) {\n\t\t\tvar oRW = xmlDoc.createElement('o:read-write');\n\t\t\toSet.appendChild(oRW);\n\t\t}\n\n\t\tvar headers = {\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t\trequesttoken: oc_requesttoken\n\t\t};\n\t\tvar body = oShare.outerHTML;\n\t\treturn DavClient.request('POST', calendar.url, headers, body).then(function (response) {\n\t\t\tif (response.status === 200) {\n\t\t\t\tif (!existingShare) {\n\t\t\t\t\tif (shareType === OC.Share.SHARE_TYPE_USER) {\n\t\t\t\t\t\tcalendar.sharedWith.users.push({\n\t\t\t\t\t\t\tid: shareWith,\n\t\t\t\t\t\t\tdisplayname: shareWith,\n\t\t\t\t\t\t\twritable: writable\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_GROUP) {\n\t\t\t\t\t\tcalendar.sharedWith.groups.push({\n\t\t\t\t\t\t\tid: shareWith,\n\t\t\t\t\t\t\tdisplayname: shareWith,\n\t\t\t\t\t\t\twritable: writable\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.unshare = function (calendar, shareType, shareWith) {\n\t\tvar xmlDoc = document.implementation.createDocument('', '', null);\n\t\tvar oShare = xmlDoc.createElement('o:share');\n\t\toShare.setAttribute('xmlns:d', 'DAV:');\n\t\toShare.setAttribute('xmlns:o', 'http://owncloud.org/ns');\n\t\txmlDoc.appendChild(oShare);\n\n\t\tvar oRemove = xmlDoc.createElement('o:remove');\n\t\toShare.appendChild(oRemove);\n\n\t\tvar dHref = xmlDoc.createElement('d:href');\n\t\tif (shareType === OC.Share.SHARE_TYPE_USER) {\n\t\t\tdHref.textContent = 'principal:principals/users/';\n\t\t} else if (shareType === OC.Share.SHARE_TYPE_GROUP) {\n\t\t\tdHref.textContent = 'principal:principals/groups/';\n\t\t}\n\t\tdHref.textContent += shareWith;\n\t\toRemove.appendChild(dHref);\n\n\t\tvar headers = {\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t\trequesttoken: oc_requesttoken\n\t\t};\n\t\tvar body = oShare.outerHTML;\n\t\treturn DavClient.request('POST', calendar.url, headers, body).then(function (response) {\n\t\t\tif (response.status === 200) {\n\t\t\t\tif (shareType === OC.Share.SHARE_TYPE_USER) {\n\t\t\t\t\tcalendar.sharedWith.users = calendar.sharedWith.users.filter(function (user) {\n\t\t\t\t\t\treturn user.id !== shareWith;\n\t\t\t\t\t});\n\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_GROUP) {\n\t\t\t\t\tcalendar.sharedWith.groups = calendar.sharedWith.groups.filter(function (groups) {\n\t\t\t\t\t\treturn groups.id !== shareWith;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t//todo - remove entry from calendar object\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t};\n\n\tthis._createXMLForProperty = function (xmlDoc, propName, value) {\n\t\tswitch (propName) {\n\t\t\tcase 'enabled':\n\t\t\t\tvar oEnabled = xmlDoc.createElement('o:calendar-enabled');\n\t\t\t\toEnabled.textContent = value ? '1' : '0';\n\t\t\t\treturn oEnabled;\n\n\t\t\tcase 'displayname':\n\t\t\t\tvar dDisplayname = xmlDoc.createElement('d:displayname');\n\t\t\t\tdDisplayname.textContent = value;\n\t\t\t\treturn dDisplayname;\n\n\t\t\tcase 'order':\n\t\t\t\tvar aOrder = xmlDoc.createElement('a:calendar-color');\n\t\t\t\taOrder.textContent = value;\n\t\t\t\treturn aOrder;\n\n\t\t\tcase 'color':\n\t\t\t\tvar aColor = xmlDoc.createElement('a:calendar-color');\n\t\t\t\taColor.textContent = value;\n\t\t\t\treturn aColor;\n\n\t\t\tcase 'components':\n\t\t\t\tvar cComponents = xmlDoc.createElement('c:supported-calendar-component-set');\n\t\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\t\tvar cComp = xmlDoc.createElement('c:comp');\n\t\t\t\t\tcComp.setAttribute('name', value[i].toUpperCase());\n\t\t\t\t\tcComponents.appendChild(cComp);\n\t\t\t\t}\n\t\t\t\treturn cComponents;\n\t\t}\n\t};\n\n\tthis._getACLFromResponse = function (body) {\n\t\tvar canWrite = false;\n\t\tvar acl = body.propStat[0].properties['{' + DavClient.NS_DAV + '}acl'];\n\t\tif (acl) {\n\t\t\tfor (var k = 0; k < acl.length; k++) {\n\t\t\t\tvar href = acl[k].getElementsByTagNameNS('DAV:', 'href');\n\t\t\t\tif (href.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\thref = href[0].textContent;\n\t\t\t\tif (href !== _this._currentUserPrincipal) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar writeNode = acl[k].getElementsByTagNameNS('DAV:', 'write');\n\t\t\t\tif (writeNode.length > 0) {\n\t\t\t\t\tcanWrite = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbody.propStat[0].properties.canWrite = canWrite;\n\t};\n\n\tthis._isUriAlreadyTaken = function (uri) {\n\t\treturn this._takenUrls.indexOf(this._CALENDAR_HOME + uri + '/') !== -1;\n\t};\n\n\tthis._suggestUri = function (displayname) {\n\t\tvar uri = displayname.toString().toLowerCase().replace(/\\s+/g, '-') // Replace spaces with -\n\t\t.replace(/[^\\w\\-]+/g, '') // Remove all non-word chars\n\t\t.replace(/\\-\\-+/g, '-') // Replace multiple - with single -\n\t\t.replace(/^-+/, '') // Trim - from start of text\n\t\t.replace(/-+$/, ''); // Trim - from end of text\n\n\t\tif (!this._isUriAlreadyTaken(uri)) {\n\t\t\treturn uri;\n\t\t}\n\n\t\tif (uri.indexOf('-') === -1) {\n\t\t\turi = uri + '-1';\n\t\t\tif (!this._isUriAlreadyTaken(uri)) {\n\t\t\t\treturn uri;\n\t\t\t}\n\t\t}\n\n\t\twhile (this._isUriAlreadyTaken(uri)) {\n\t\t\tvar positionLastDash = uri.lastIndexOf('-');\n\t\t\tvar firstPart = uri.substr(0, positionLastDash);\n\t\t\tvar lastPart = uri.substr(positionLastDash + 1);\n\n\t\t\tif (lastPart.match(/^\\d+$/)) {\n\t\t\t\tlastPart = parseInt(lastPart);\n\t\t\t\tlastPart++;\n\n\t\t\t\turi = firstPart + '-' + lastPart;\n\t\t\t} else if (lastPart === '') {\n\t\t\t\turi = uri + '1';\n\t\t\t} else {\n\t\t\t\turi = uri = '-1';\n\t\t\t}\n\t\t}\n\n\t\treturn uri;\n\t};\n}]);","'use strict';\n\nangular.module('Tasks').service('DavClient', [function () {\n\t'use strict';\n\n\tvar client;\n\tclient = new dav.Client({\n\t\tbaseUrl: OC.linkToRemote('dav/calendars'),\n\t\txmlNamespaces: {\n\t\t\t'DAV:': 'd',\n\t\t\t'urn:ietf:params:xml:ns:caldav': 'c',\n\t\t\t'http://apple.com/ns/ical/': 'aapl',\n\t\t\t'http://owncloud.org/ns': 'oc',\n\t\t\t'http://nextcloud.com/ns': 'nc',\n\t\t\t'http://calendarserver.org/ns/': 'cs'\n\t\t}\n\t});\n\tangular.extend(client, {\n\t\tNS_DAV: 'DAV:',\n\t\tNS_IETF: 'urn:ietf:params:xml:ns:caldav',\n\t\tNS_APPLE: 'http://apple.com/ns/ical/',\n\t\tNS_OWNCLOUD: 'http://owncloud.org/ns',\n\t\tNS_NEXTCLOUD: 'http://nextcloud.com/ns',\n\t\tNS_CALENDARSERVER: 'http://calendarserver.org/ns/',\n\t\tbuildUrl: function buildUrl(path) {\n\t\t\treturn window.location.protocol + '//' + window.location.host + path;\n\t\t},\n\t\twasRequestSuccessful: function wasRequestSuccessful(status) {\n\t\t\treturn status >= 200 && status <= 299;\n\t\t}\n\t});\n\treturn client;\n}]);","'use strict';\n\nangular.module('Tasks').service('ICalFactory', [function () {\n  'use strict';\n\n  // creates a new ICAL root element with a product id property\n\n  return {\n    new: function _new() {\n      var root = new ICAL.Component(['vcalendar', [], []]);\n\n      var version = angular.element('#app').attr('data-appVersion');\n      root.updatePropertyWithValue('prodid', '-//Nextcloud Tasks v' + version);\n\n      return root;\n    }\n  };\n}]);","'use strict';\n\nangular.module('Tasks').factory('Loading', [function () {\n\t'use strict';\n\n\tvar Loading = function () {\n\t\tfunction Loading() {\n\t\t\tthis.count = 0;\n\t\t}\n\n\t\tLoading.prototype.increase = function () {\n\t\t\treturn this.count += 1;\n\t\t};\n\n\t\tLoading.prototype.decrease = function () {\n\t\t\treturn this.count -= 1;\n\t\t};\n\n\t\tLoading.prototype.getCount = function () {\n\t\t\treturn this.count;\n\t\t};\n\n\t\tLoading.prototype.isLoading = function () {\n\t\t\treturn this.count > 0;\n\t\t};\n\n\t\treturn Loading;\n\t}();\n\treturn new Loading();\n}]);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tangular.module('Tasks').factory('_Model', [function () {\n\t\tvar Model;\n\t\tModel = function () {\n\t\t\tfunction Model() {\n\t\t\t\tthis._data = [];\n\t\t\t\tthis._dataMap = {};\n\t\t\t\tthis._filterCache = {};\n\t\t\t}\n\n\t\t\tModel.prototype.handle = function (data) {\n\t\t\t\tvar item, _i, _len, _results;\n\t\t\t\t_results = [];\n\t\t\t\tfor (_i = 0, _len = data.length; _i < _len; _i++) {\n\t\t\t\t\titem = data[_i];\n\t\t\t\t\t_results.push(this.add(item));\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t};\n\n\t\t\tModel.prototype.add = function (data, clearCache) {\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tif (clearCache) {\n\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t}\n\t\t\t\tif (angular.isDefined(this._dataMap[data.id])) {\n\t\t\t\t\treturn this.update(data, clearCache);\n\t\t\t\t} else {\n\t\t\t\t\tthis._data.push(data);\n\t\t\t\t\tthis._dataMap[data.id] = data;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tModel.prototype.update = function (data, clearCache) {\n\t\t\t\tvar entry, key, value, _results;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tif (clearCache) {\n\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t}\n\t\t\t\tentry = this.getById(data.id);\n\t\t\t\t_results = [];\n\t\t\t\tfor (key in data) {\n\t\t\t\t\tvalue = data[key];\n\t\t\t\t\tif (key === 'id') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_results.push(entry[key] = value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t};\n\n\t\t\tModel.prototype.getById = function (id) {\n\t\t\t\treturn this._dataMap[id];\n\t\t\t};\n\n\t\t\tModel.prototype.getAll = function () {\n\t\t\t\treturn this._data;\n\t\t\t};\n\n\t\t\tModel.prototype.removeById = function (id, clearCache) {\n\t\t\t\tvar counter, data, entry, _i, _len, _ref;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\t_ref = this._data;\n\t\t\t\tfor (counter = _i = 0, _len = _ref.length; _i < _len; counter = ++_i) {\n\t\t\t\t\tentry = _ref[counter];\n\t\t\t\t\tif (entry.id === id) {\n\t\t\t\t\t\tthis._data.splice(counter, 1);\n\t\t\t\t\t\tdata = this._dataMap[id];\n\t\t\t\t\t\tdelete this._dataMap[id];\n\t\t\t\t\t\tif (clearCache) {\n\t\t\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tModel.prototype.clear = function () {\n\t\t\t\tthis._data.length = 0;\n\t\t\t\tthis._dataMap = {};\n\t\t\t\treturn this._invalidateCache();\n\t\t\t};\n\n\t\t\tModel.prototype._invalidateCache = function () {\n\t\t\t\tthis._filterCache = {};\n\t\t\t};\n\n\t\t\tModel.prototype.get = function (query) {\n\t\t\t\tvar hash;\n\t\t\t\thash = query.hashCode();\n\t\t\t\tif (!angular.isDefined(this._filterCache[hash])) {\n\t\t\t\t\tthis._filterCache[hash] = query.exec(this._data);\n\t\t\t\t}\n\t\t\t\treturn this._filterCache[hash];\n\t\t\t};\n\n\t\t\tModel.prototype.size = function () {\n\t\t\t\treturn this._data.length;\n\t\t\t};\n\n\t\t\treturn Model;\n\t\t}();\n\t\treturn Model;\n\t}]);\n}).call(undefined);","'use strict';\n\nangular.module('Tasks').factory('Persistence', ['Request', 'Loading', '$rootScope', '$q', 'CalendarService', function (Request, Loading, $rootScope, $q, CalendarService) {\n\t'use strict';\n\n\tvar Persistence = function () {\n\t\tfunction Persistence(_request, _Loading, _$rootScope, _CalendarService) {\n\t\t\tthis._request = _request;\n\t\t\tthis._Loading = _Loading;\n\t\t\tthis._$rootScope = _$rootScope;\n\t\t\tthis._CalendarService = _CalendarService;\n\t\t}\n\n\t\tPersistence.prototype.init = function () {\n\t\t\tvar successCallback,\n\t\t\t    _this = this;\n\t\t\tthis.deferred = $q.defer();\n\t\t\tsuccessCallback = function successCallback() {\n\t\t\t\treturn _this.deferred.resolve();\n\t\t\t};\n\t\t\tthis.getCollections();\n\t\t\tthis.getSettings();\n\t\t\treturn this.deferred.promise;\n\t\t};\n\n\t\tPersistence.prototype.getCollections = function (onSuccess, showLoading) {\n\t\t\tvar failureCallbackWrapper,\n\t\t\t    params,\n\t\t\t    successCallbackWrapper,\n\t\t\t    _this = this;\n\t\t\tif (showLoading === null) {\n\t\t\t\tshowLoading = true;\n\t\t\t}\n\t\t\tif (!onSuccess) {\n\t\t\t\tonSuccess = function onSuccess() {};\n\t\t\t}\n\t\t\tif (showLoading) {\n\t\t\t\tthis._Loading.increase();\n\t\t\t\tsuccessCallbackWrapper = function successCallbackWrapper(data) {\n\t\t\t\t\tonSuccess();\n\t\t\t\t\treturn _this._Loading.decrease();\n\t\t\t\t};\n\t\t\t\tfailureCallbackWrapper = function failureCallbackWrapper(data) {\n\t\t\t\t\treturn _this._Loading.decrease();\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tsuccessCallbackWrapper = function successCallbackWrapper(data) {\n\t\t\t\t\treturn onSuccess();\n\t\t\t\t};\n\t\t\t\tfailureCallbackWrapper = function failureCallbackWrapper(data) {};\n\t\t\t}\n\t\t\tparams = {\n\t\t\t\tonSuccess: successCallbackWrapper,\n\t\t\t\tonFailure: failureCallbackWrapper\n\t\t\t};\n\t\t\treturn this._request.get('/apps/tasks/collections', params);\n\t\t};\n\n\t\tPersistence.prototype.getSettings = function (onSuccess, showLoading) {\n\t\t\tvar failureCallbackWrapper,\n\t\t\t    params,\n\t\t\t    successCallbackWrapper,\n\t\t\t    _this = this;\n\t\t\tif (showLoading === null) {\n\t\t\t\tshowLoading = true;\n\t\t\t}\n\t\t\tif (!onSuccess) {\n\t\t\t\tonSuccess = function onSuccess() {};\n\t\t\t}\n\t\t\tif (showLoading) {\n\t\t\t\tthis._Loading.increase();\n\t\t\t\tsuccessCallbackWrapper = function successCallbackWrapper(data) {\n\t\t\t\t\tonSuccess();\n\t\t\t\t\treturn _this._Loading.decrease();\n\t\t\t\t};\n\t\t\t\tfailureCallbackWrapper = function failureCallbackWrapper(data) {\n\t\t\t\t\treturn _this._Loading.decrease();\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tsuccessCallbackWrapper = function successCallbackWrapper(data) {\n\t\t\t\t\treturn onSuccess();\n\t\t\t\t};\n\t\t\t\tfailureCallbackWrapper = function failureCallbackWrapper(data) {};\n\t\t\t}\n\t\t\tparams = {\n\t\t\t\tonSuccess: successCallbackWrapper,\n\t\t\t\tonFailure: failureCallbackWrapper\n\t\t\t};\n\t\t\treturn this._request.get('/apps/tasks/settings', params);\n\t\t};\n\n\t\tPersistence.prototype.setVisibility = function (collectionID, visibility) {\n\t\t\tvar params = {\n\t\t\t\trouteParams: {\n\t\t\t\t\tcollectionID: collectionID,\n\t\t\t\t\tvisibility: visibility\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn this._request.post('/apps/tasks/collection/{collectionID}/visibility/{visibility}', params);\n\t\t};\n\n\t\tPersistence.prototype.setting = function (type, setting, value) {\n\t\t\tvar params = {\n\t\t\t\trouteParams: {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tsetting: setting,\n\t\t\t\t\tvalue: value\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn this._request.post('/apps/tasks/settings/{type}/{setting}/{value}', params);\n\t\t};\n\t\treturn Persistence;\n\t}();\n\treturn new Persistence(Request, Loading, $rootScope, CalendarService);\n}]);","'use strict';\n\nangular.module('Tasks').factory('Publisher', ['CollectionsModel', 'SettingsModel', function (CollectionsModel, SettingsModel) {\n\t'use strict';\n\n\tvar Publisher = function () {\n\t\tfunction Publisher(_$collectionsmodel, _$settingsmodel) {\n\t\t\tthis._$collectionsmodel = _$collectionsmodel;\n\t\t\tthis._$settingsmodel = _$settingsmodel;\n\t\t\tthis._subscriptions = {};\n\t\t\tthis.subscribeObjectTo(this._$collectionsmodel, 'collections');\n\t\t\tthis.subscribeObjectTo(this._$settingsmodel, 'settings');\n\t\t}\n\n\t\tPublisher.prototype.subscribeObjectTo = function (object, name) {\n\t\t\tvar base = this._subscriptions;\n\t\t\tif (!base[name]) {\n\t\t\t\tbase[name] = [];\n\t\t\t}\n\t\t\treturn this._subscriptions[name].push(object);\n\t\t};\n\n\t\tPublisher.prototype.publishDataTo = function (data, name) {\n\t\t\tvar ref, results, subscriber, _i, _len;\n\t\t\tref = this._subscriptions[name] || [];\n\t\t\tresults = [];\n\t\t\tfor (_i = 0, _len = ref.length; _i < _len; _i++) {\n\t\t\t\tsubscriber = ref[_i];\n\t\t\t\tresults.push(subscriber.handle(data));\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\t\treturn Publisher;\n\t}();\n\treturn new Publisher(CollectionsModel, SettingsModel);\n}]);","'use strict';\n\nangular.module('Tasks').factory('RandomStringService', function () {\n  'use strict';\n\n  return {\n    generate: function generate() {\n      return Math.random().toString(36).substr(2);\n    }\n  };\n});","'use strict';\n\nangular.module('Tasks').factory('Request', ['$http', 'Publisher', function ($http, Publisher) {\n\t'use strict';\n\n\tvar Request = function () {\n\t\tfunction Request($http, publisher) {\n\t\t\tthis.$http = $http;\n\t\t\tthis.publisher = publisher;\n\t\t\tthis.count = 0;\n\t\t\tthis.initialized = false;\n\t\t\tthis.shelvedRequests = [];\n\t\t\tthis.initialized = true;\n\t\t\tthis._executeShelvedRequests();\n\t\t}\n\n\t\tRequest.prototype.request = function (route, data) {\n\t\t\tvar defaultConfig, defaultData, url;\n\t\t\tif (data === null) {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tdefaultData = {\n\t\t\t\trouteParams: {},\n\t\t\t\tdata: {},\n\t\t\t\tonSuccess: function onSuccess() {\n\t\t\t\t\treturn {};\n\t\t\t\t},\n\t\t\t\tonFailure: function onFailure() {\n\t\t\t\t\treturn {};\n\t\t\t\t},\n\t\t\t\tconfig: {}\n\t\t\t};\n\t\t\tangular.extend(defaultData, data);\n\t\t\tif (!this.initialized) {\n\t\t\t\tthis._shelveRequest(route, defaultData);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\turl = OC.generateUrl(route, defaultData.routeParams);\n\t\t\tdefaultConfig = {\n\t\t\t\turl: url,\n\t\t\t\tdata: defaultData.data\n\t\t\t};\n\t\t\tangular.extend(defaultConfig, defaultData.config);\n\t\t\tif (defaultConfig.method === 'GET') {\n\t\t\t\tdefaultConfig.params = defaultConfig.data;\n\t\t\t}\n\t\t\treturn this.$http(defaultConfig).then(function (_this) {\n\t\t\t\treturn function (response) {\n\t\t\t\t\tvar name, ref, value;\n\t\t\t\t\tref = response.data.data;\n\t\t\t\t\tfor (name in ref) {\n\t\t\t\t\t\tvalue = ref[name];\n\t\t\t\t\t\t_this.publisher.publishDataTo(value, name);\n\t\t\t\t\t}\n\t\t\t\t\treturn defaultData.onSuccess(response.data, response.status, response.headers, response.config);\n\t\t\t\t};\n\t\t\t}(this)).catch(function (response) {\n\t\t\t\treturn defaultData.onFailure(response.data, response.status, response.headers, response.config);\n\t\t\t});\n\t\t};\n\n\t\tRequest.prototype.post = function (route, data) {\n\t\t\tif (data === null) {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tif (!data.config) {\n\t\t\t\tdata.config = {};\n\t\t\t}\n\t\t\tdata.config.method = 'POST';\n\t\t\treturn this.request(route, data);\n\t\t};\n\n\t\tRequest.prototype.get = function (route, data) {\n\t\t\tif (data === null) {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tif (!data.config) {\n\t\t\t\tdata.config = {};\n\t\t\t}\n\t\t\tdata.config.method = 'GET';\n\t\t\treturn this.request(route, data);\n\t\t};\n\n\t\tRequest.prototype.put = function (route, data) {\n\t\t\tif (data === null) {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tif (!data.config) {\n\t\t\t\tdata.config = {};\n\t\t\t}\n\t\t\tdata.config.method = 'PUT';\n\t\t\treturn this.request(route, data);\n\t\t};\n\n\t\tRequest.prototype[\"delete\"] = function (route, data) {\n\t\t\tif (data === null) {\n\t\t\t\tdata = {};\n\t\t\t}\n\t\t\tif (!data.config) {\n\t\t\t\tdata.config = {};\n\t\t\t}\n\t\t\tdata.config.method = 'DELETE';\n\t\t\treturn this.request(route, data);\n\t\t};\n\n\t\tRequest.prototype._shelveRequest = function (route, data) {\n\t\t\tvar request = {\n\t\t\t\troute: route,\n\t\t\t\tdata: data\n\t\t\t};\n\t\t\treturn this.shelvedRequests.push(request);\n\t\t};\n\n\t\tRequest.prototype._executeShelvedRequests = function () {\n\t\t\tvar r, ref, results, _i, _len;\n\t\t\tref = this.shelvedRequests;\n\t\t\tresults = [];\n\t\t\tfor (_i = 0, _len = ref.length; _i < _len; _i++) {\n\t\t\t\tr = ref[_i];\n\t\t\t\tresults.push(this.request(r.route, r.data));\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\t\treturn Request;\n\t}();\n\treturn new Request($http, Publisher);\n}]);","'use strict';\n\nangular.module('Tasks').factory('Status', [function () {\n  'use strict';\n\n  var Status;\n  Status = function () {\n    function Status() {\n      this._$status = {\n        addingList: false,\n        focusTaskInput: false\n      };\n    }\n\n    Status.prototype.getStatus = function () {\n      return this._$status;\n    };\n\n    return Status;\n  }();\n  return new Status();\n}]);","'use strict';\n\nangular.module('Tasks').service('VTodoService', ['DavClient', 'RandomStringService', '$timeout', function (DavClient, RandomStringService, $timeout) {\n\t'use strict';\n\n\tvar _this = this;\n\n\tthis.getAll = function (calendar, completed, parent) {\n\t\tif (completed === null) {\n\t\t\tcompleted = false;\n\t\t}\n\t\tif (parent === null) {\n\t\t\tparent = false;\n\t\t}\n\t\tvar xmlDoc = document.implementation.createDocument('', '', null);\n\t\tvar cCalQuery = xmlDoc.createElement('c:calendar-query');\n\t\tcCalQuery.setAttribute('xmlns:c', 'urn:ietf:params:xml:ns:caldav');\n\t\tcCalQuery.setAttribute('xmlns:d', 'DAV:');\n\t\tcCalQuery.setAttribute('xmlns:a', 'http://apple.com/ns/ical/');\n\t\tcCalQuery.setAttribute('xmlns:o', 'http://owncloud.org/ns');\n\t\txmlDoc.appendChild(cCalQuery);\n\n\t\tvar dProp = xmlDoc.createElement('d:prop');\n\t\tcCalQuery.appendChild(dProp);\n\n\t\tvar dGetEtag = xmlDoc.createElement('d:getetag');\n\t\tdProp.appendChild(dGetEtag);\n\n\t\tvar cCalendarData = xmlDoc.createElement('c:calendar-data');\n\t\tdProp.appendChild(cCalendarData);\n\n\t\tvar cFilter = xmlDoc.createElement('c:filter');\n\t\tcCalQuery.appendChild(cFilter);\n\n\t\tvar cCompFilterVCal = xmlDoc.createElement('c:comp-filter');\n\t\tcCompFilterVCal.setAttribute('name', 'VCALENDAR');\n\t\tcFilter.appendChild(cCompFilterVCal);\n\n\t\tvar cCompFilterVTodo = xmlDoc.createElement('c:comp-filter');\n\t\tcCompFilterVTodo.setAttribute('name', 'VTODO');\n\t\tcCompFilterVCal.appendChild(cCompFilterVTodo);\n\n\t\tvar cPropFilterCompleted = xmlDoc.createElement('c:prop-filter');\n\t\tcPropFilterCompleted.setAttribute('name', 'COMPLETED');\n\t\tcCompFilterVTodo.appendChild(cPropFilterCompleted);\n\n\t\tif (!completed) {\n\t\t\tvar cIsNotDefined = xmlDoc.createElement('c:is-not-defined');\n\t\t\tcPropFilterCompleted.appendChild(cIsNotDefined);\n\t\t}\n\n\t\tif (parent) {\n\t\t\tvar cPropFilterRelated = xmlDoc.createElement('c:prop-filter');\n\t\t\tcPropFilterRelated.setAttribute('name', 'RELATED-TO');\n\t\t\tcCompFilterVTodo.appendChild(cPropFilterRelated);\n\t\t\tvar cTextMatch = xmlDoc.createElement('c:text-match');\n\t\t\tvar cTextMatchValue = xmlDoc.createTextNode(parent.uid);\n\t\t\tcTextMatch.appendChild(cTextMatchValue);\n\t\t\tcPropFilterRelated.appendChild(cTextMatch);\n\t\t}\n\n\t\t// var cPropFilterStatus = xmlDoc.createElement('c:prop-filter');\n\t\t// cPropFilterStatus.setAttribute('name', 'STATUS');\n\t\t// cCompFilterVTodo.appendChild(cPropFilterStatus);\n\n\t\t// var cTextMatch = xmlDoc.createElement('c:text-match');\n\t\t// cTextMatch.setAttribute('negate-condition', 'yes');\n\t\t// var cTextMatchValue = xmlDoc.createTextNode('CANCELLED');\n\t\t// cTextMatch.appendChild(cTextMatchValue);\n\t\t// cPropFilterStatus.appendChild(cTextMatch);\n\n\t\t// var cTimeRange = xmlDoc.createElement('c:time-range');\n\t\t// cTimeRange.setAttribute('start', this._getTimeRangeStamp(start));\n\t\t// cTimeRange.setAttribute('end', this._getTimeRangeStamp(end));\n\t\t// cCompFilterVTodo.appendChild(cTimeRange);\n\n\t\tvar url = calendar.url;\n\t\tvar headers = {\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t\t'Depth': 1,\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\t\tvar body = cCalQuery.outerHTML;\n\n\t\treturn DavClient.request('REPORT', url, headers, body).then(function (response) {\n\t\t\tif (!DavClient.wasRequestSuccessful(response.status)) {\n\t\t\t\t//TODO - something went wrong\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar vTodos = [];\n\n\t\t\tfor (var i in response.body) {\n\t\t\t\tvar object = response.body[i];\n\t\t\t\tvar properties = object.propStat[0].properties;\n\n\t\t\t\tvar uri = object.href.substr(object.href.lastIndexOf('/') + 1);\n\n\t\t\t\tvar vTodo = {\n\t\t\t\t\tcalendar: calendar,\n\t\t\t\t\tproperties: properties,\n\t\t\t\t\turi: uri\n\t\t\t\t};\n\t\t\t\tvTodos.push(vTodo);\n\t\t\t}\n\n\t\t\treturn vTodos;\n\t\t});\n\t};\n\n\tthis.get = function (calendar, uri) {\n\t\tvar url = calendar.url + uri;\n\t\treturn DavClient.request('GET', url, { 'requesttoken': OC.requestToken }, '').then(function (response) {\n\t\t\tvar vTodo = {\n\t\t\t\tcalendar: calendar,\n\t\t\t\tproperties: {\n\t\t\t\t\t'{urn:ietf:params:xml:ns:caldav}calendar-data': response.body,\n\t\t\t\t\t'{DAV:}getetag': response.xhr.getResponseHeader('ETag') },\n\t\t\t\turi: uri\n\t\t\t};\n\t\t\treturn vTodo;\n\t\t});\n\t};\n\n\tthis.create = function (calendar, data, returnTodo) {\n\t\tif (typeof returnTodo === 'undefined') {\n\t\t\treturnTodo = true;\n\t\t}\n\n\t\tvar headers = {\n\t\t\t'Content-Type': 'text/calendar; charset=utf-8',\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\t\tvar uri = this._generateRandomUri();\n\t\tvar url = calendar.url + uri;\n\n\t\treturn DavClient.request('PUT', url, headers, data).then(function (response) {\n\t\t\tif (!DavClient.wasRequestSuccessful(response.status)) {\n\t\t\t\tconsole.log(response);\n\t\t\t\treturn false;\n\t\t\t\t// TODO - something went wrong, do smth about it\n\t\t\t}\n\n\t\t\treturn returnTodo ? _this.get(calendar, uri) : true;\n\t\t});\n\t};\n\n\tthis.update = function (task) {\n\t\tvar url = task.calendar.url + task.uri;\n\t\tvar headers = {\n\t\t\t'Content-Type': 'text/calendar; charset=utf-8',\n\t\t\t'If-Match': task.etag,\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\t\t$timeout.cancel(task.timers.update);\n\t\treturn DavClient.request('PUT', url, headers, task.data).then(function (response) {\n\t\t\ttask.etag = response.xhr.getResponseHeader('ETag');\n\t\t\treturn DavClient.wasRequestSuccessful(response.status);\n\t\t});\n\t};\n\n\tthis.delete = function (task) {\n\t\tvar url = task.calendar.url + task.uri;\n\t\tvar headers = {\n\t\t\t'If-Match': task.etag,\n\t\t\t'requesttoken': OC.requestToken\n\t\t};\n\n\t\treturn DavClient.request('DELETE', url, headers, '').then(function (response) {\n\t\t\treturn DavClient.wasRequestSuccessful(response.status);\n\t\t});\n\t};\n\n\tthis._generateRandomUri = function () {\n\t\tvar uri = 'Nextcloud-';\n\t\turi += RandomStringService.generate();\n\t\turi += RandomStringService.generate();\n\t\turi += '.ics';\n\n\t\treturn uri;\n\t};\n\n\t// this._getTimeRangeStamp = function(momentObject) {\n\t// \treturn momentObject.format('YYYYMMDD') + 'T' + momentObject.format('HHmmss') + 'Z';\n\t// };\n}]);","'use strict';\n\nangular.module('Tasks').factory('ListsBusinessLayer', ['ListsModel', 'Persistence', 'TasksBusinessLayer', 'CalendarService', function (ListsModel, Persistence, TasksBusinessLayer, CalendarService) {\n\t'use strict';\n\n\tvar ListsBusinessLayer;\n\tListsBusinessLayer = function () {\n\t\tfunction ListsBusinessLayer(_$listsmodel, _persistence, _$tasksbusinesslayer, _$calendarservice) {\n\t\t\tthis._$listsmodel = _$listsmodel;\n\t\t\tthis._persistence = _persistence;\n\t\t\tthis._$tasksbusinesslayer = _$tasksbusinesslayer;\n\t\t\tthis._$calendarservice = _$calendarservice;\n\t\t}\n\n\t\tListsBusinessLayer.prototype.init = function () {\n\t\t\treturn this._$calendarservice.getAll().then(function (calendars) {\n\t\t\t\tvar calendar, _i, _len, _results;\n\t\t\t\t_results = [];\n\t\t\t\tfor (_i = 0, _len = calendars.length; _i < _len; _i++) {\n\t\t\t\t\tcalendar = calendars[_i];\n\t\t\t\t\tListsModel.add(calendar);\n\t\t\t\t\t_results.push(TasksBusinessLayer.getAll(calendar));\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t});\n\t\t};\n\n\t\tListsBusinessLayer.prototype.add = function (calendar, color) {\n\t\t\treturn this._$calendarservice.create(calendar, color, ['vtodo']).then(function (calendar) {\n\t\t\t\tListsModel.add(calendar);\n\t\t\t\treturn calendar;\n\t\t\t});\n\t\t};\n\n\t\tListsBusinessLayer.prototype[\"delete\"] = function (calendar) {\n\t\t\treturn this._$calendarservice[\"delete\"](calendar).then(function () {\n\t\t\t\treturn ListsModel[\"delete\"](calendar);\n\t\t\t});\n\t\t};\n\n\t\tListsBusinessLayer.prototype.rename = function (calendar) {\n\t\t\tthis._$calendarservice.update(calendar).then(function (calendar) {\n\t\t\t\tcalendar.dropPreviousState();\n\t\t\t});\n\t\t};\n\n\t\treturn ListsBusinessLayer;\n\t}();\n\treturn new ListsBusinessLayer(ListsModel, Persistence, TasksBusinessLayer, CalendarService);\n}]);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __bind = function __bind(fn, me) {\n\t\treturn function () {\n\t\t\treturn fn.apply(me, arguments);\n\t\t};\n\t};\n\n\tangular.module('Tasks').factory('SearchBusinessLayer', ['ListsModel', 'Persistence', 'TasksModel', '$rootScope', '$routeParams', '$location', function (ListsModel, Persistence, TasksModel, $rootScope, $routeParams, $location) {\n\t\tvar SearchBusinessLayer;\n\t\tSearchBusinessLayer = function () {\n\t\t\tfunction SearchBusinessLayer(_$listsmodel, _persistence, _$tasksmodel, _$rootScope, _$routeparams, _$location) {\n\t\t\t\tthis._$listsmodel = _$listsmodel;\n\t\t\t\tthis._persistence = _persistence;\n\t\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\t\tthis._$rootScope = _$rootScope;\n\t\t\t\tthis._$routeparams = _$routeparams;\n\t\t\t\tthis._$location = _$location;\n\t\t\t\tthis.getFilter = __bind(this.getFilter, this);\n\t\t\t\tthis.setFilter = __bind(this.setFilter, this);\n\t\t\t\tthis.attach = __bind(this.attach, this);\n\t\t\t\tthis.initialize();\n\t\t\t\tthis._$searchString = '';\n\t\t\t}\n\n\t\t\tSearchBusinessLayer.prototype.attach = function (search) {\n\t\t\t\tvar _this = this;\n\t\t\t\tsearch.setFilter('tasks', function (query) {\n\t\t\t\t\treturn _this._$rootScope.$apply(function () {\n\t\t\t\t\t\treturn _this.setFilter(query);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tsearch.setRenderer('task', this.renderTaskResult.bind(this));\n\t\t\t\treturn search.setHandler('task', this.handleTaskClick.bind(this));\n\t\t\t};\n\n\t\t\tSearchBusinessLayer.prototype.setFilter = function (query) {\n\t\t\t\tthis._$searchString = query;\n\t\t\t};\n\n\t\t\tSearchBusinessLayer.prototype.getFilter = function () {\n\t\t\t\treturn this._$searchString;\n\t\t\t};\n\n\t\t\tSearchBusinessLayer.prototype.initialize = function () {\n\t\t\t\tvar _this = this;\n\t\t\t\tthis.handleTaskClick = function ($row, result, event) {\n\t\t\t\t\treturn _this._$location.path('/lists/' + result.calendarid + '/tasks/' + result.id);\n\t\t\t\t};\n\t\t\t\tthis.renderTaskResult = function ($row, result) {\n\t\t\t\t\tvar $template;\n\t\t\t\t\tif (!_this._$tasksmodel.filterTasks(result, _this._$routeparams.listID) || !_this._$tasksmodel.isLoaded(result)) {\n\t\t\t\t\t\t$template = $('div.task-item.template');\n\t\t\t\t\t\t$template = $template.clone();\n\t\t\t\t\t\t$row = $('<tr class=\"result\"></tr>').append($template.removeClass('template'));\n\t\t\t\t\t\t$row.data('result', result);\n\t\t\t\t\t\t$row.find('span.title').text(result.name);\n\t\t\t\t\t\tif (result.starred) {\n\t\t\t\t\t\t\t$row.find('span.task-star').addClass('task-starred');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.completed) {\n\t\t\t\t\t\t\t$row.find('div.task-item').addClass('done');\n\t\t\t\t\t\t\t$row.find('span.task-checkbox').addClass('svg-checkmark');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.complete) {\n\t\t\t\t\t\t\t$row.find('div.percentdone').css({\n\t\t\t\t\t\t\t\t'width': result.complete + '%',\n\t\t\t\t\t\t\t\t'background-color': '' + _this._$listsmodel.getColor(result.calendarid)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.note) {\n\t\t\t\t\t\t\t$row.find('div.title-wrapper').addClass('attachment');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn $row;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn OC.Plugins.register('OCA.Search', this);\n\t\t\t};\n\n\t\t\treturn SearchBusinessLayer;\n\t\t}();\n\t\treturn new SearchBusinessLayer(ListsModel, Persistence, TasksModel, $rootScope, $routeParams, $location);\n\t}]);\n}).call(undefined);","'use strict';\n\nangular.module('Tasks').factory('SettingsBusinessLayer', ['Persistence', 'SettingsModel', function (Persistence, SettingsModel) {\n\t'use strict';\n\n\tvar SettingsBusinessLayer = function () {\n\t\tfunction SettingsBusinessLayer(_persistence, _$settingsmodel) {\n\t\t\tthis._persistence = _persistence;\n\t\t\tthis._$settingsmodel = _$settingsmodel;\n\t\t}\n\n\t\tSettingsBusinessLayer.prototype.updateModel = function () {\n\t\t\tvar success,\n\t\t\t    _this = this;\n\t\t\tsuccess = function success() {};\n\t\t\treturn this._persistence.getCollections(success, true);\n\t\t};\n\n\t\tSettingsBusinessLayer.prototype.setVisibility = function (collectionID, visibility) {\n\t\t\treturn this._persistence.setVisibility(collectionID, visibility);\n\t\t};\n\n\t\tSettingsBusinessLayer.prototype.toggle = function (type, setting) {\n\t\t\tthis._$settingsmodel.toggle(type, setting);\n\t\t\tvar value = this._$settingsmodel.getById(type)[setting];\n\t\t\treturn this._persistence.setting(type, setting, +value);\n\t\t};\n\n\t\tSettingsBusinessLayer.prototype.set = function (type, setting, value) {\n\t\t\treturn this._persistence.setting(type, setting, value);\n\t\t};\n\n\t\treturn SettingsBusinessLayer;\n\t}();\n\treturn new SettingsBusinessLayer(Persistence, SettingsModel);\n}]);","'use strict';\n\nangular.module('Tasks').factory('TasksBusinessLayer', ['TasksModel', 'Persistence', 'VTodoService', 'VTodo', '$timeout', function (TasksModel, Persistence, VTodoService, VTodo, $timeout) {\n\t'use strict';\n\n\tvar TasksBusinessLayer;\n\tTasksBusinessLayer = function () {\n\t\tfunction TasksBusinessLayer(_$tasksmodel, _persistence, _$vtodoservice, _$vtodo, $timeout) {\n\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\tthis._persistence = _persistence;\n\t\t\tthis._$vtodoservice = _$vtodoservice;\n\t\t}\n\n\t\tTasksBusinessLayer.prototype.getAll = function (calendar, completed, parent) {\n\t\t\treturn this._$vtodoservice.getAll(calendar, completed, parent).then(function (tasks) {\n\t\t\t\tvar task, _i, _len, _results;\n\t\t\t\t_results = [];\n\t\t\t\tfor (_i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\tvar vTodo = new VTodo(task.calendar, task.properties, task.uri);\n\t\t\t\t\t_results.push(TasksModel.ad(vTodo));\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t});\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.add = function (task) {\n\t\t\treturn this._$vtodoservice.create(task.calendar, task.data).then(function (task) {\n\t\t\t\tvar vTodo = new VTodo(task.calendar, task.properties, task.uri);\n\t\t\t\tTasksModel.ad(vTodo);\n\t\t\t\treturn vTodo;\n\t\t\t});\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.getTask = function (calendar, uri) {\n\t\t\treturn this._$vtodoservice.get(calendar, uri).then(function (task) {\n\t\t\t\treturn new VTodo(task.calendar, task.properties, task.uri);\n\t\t\t});\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setPriority = function (task, priority) {\n\t\t\tif (task.calendar.writable) {\n\t\t\t\ttask.priority = priority;\n\t\t\t\tthis.doUpdate(task);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setPercentComplete = function (task, percentComplete) {\n\t\t\tif (task.calendar.writable) {\n\t\t\t\tif (percentComplete < 100) {\n\t\t\t\t\tthis.uncompleteParents(task.related);\n\t\t\t\t} else {\n\t\t\t\t\tthis.completeChildren(task);\n\t\t\t\t}\n\t\t\t\ttask.complete = percentComplete;\n\t\t\t\tthis.triggerUpdate(task);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.triggerUpdate = function (task, duration) {\n\t\t\tif (!duration) {\n\t\t\t\tduration = 1000;\n\t\t\t}\n\t\t\tif (task.timers.update) {\n\t\t\t\t$timeout.cancel(task.timers.update);\n\t\t\t}\n\t\t\ttask.timers.update = $timeout(function (task) {\n\t\t\t\tVTodoService.update(task);\n\t\t\t}, duration, true, task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.doUpdate = function (task) {\n\t\t\treturn this._$vtodoservice.update(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.completeChildren = function (task) {\n\t\t\tvar child, _i, _len;\n\t\t\tvar children = this._$tasksmodel.getChildren(task);\n\t\t\tvar _results = [];\n\t\t\tfor (_i = 0, _len = children.length; _i < _len; _i++) {\n\t\t\t\tchild = children[_i];\n\t\t\t\t_results.push(this.setPercentComplete(child, 100));\n\t\t\t}\n\t\t\treturn _results;\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.uncompleteParents = function (uid) {\n\t\t\tif (uid) {\n\t\t\t\tvar parent = this._$tasksmodel.getByUid(uid);\n\t\t\t\tif (parent.completed) {\n\t\t\t\t\treturn this.setPercentComplete(parent, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setHideSubtasks = function (task, hide) {\n\t\t\ttask.hideSubtasks = hide;\n\t\t\tif (task.calendar.writable) {\n\t\t\t\tthis.doUpdate(task);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setHideCompletedSubtasks = function (task, hide) {\n\t\t\ttask.hideCompletedSubtasks = hide;\n\t\t\tif (task.calendar.writable) {\n\t\t\t\tthis.doUpdate(task);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.deleteTask = function (task) {\n\t\t\tvar child, children, _i, _len;\n\t\t\tchildren = this._$tasksmodel.getChildren(task);\n\t\t\tfor (_i = 0, _len = children.length; _i < _len; _i++) {\n\t\t\t\tchild = children[_i];\n\t\t\t\tthis.deleteTask(child);\n\t\t\t}\n\t\t\treturn this._$vtodoservice[\"delete\"](task).then(function () {\n\t\t\t\treturn TasksModel[\"delete\"](task);\n\t\t\t});\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.momentToICALTime = function (moment, asDate) {\n\t\t\tif (asDate) {\n\t\t\t\treturn ICAL.Time.fromDateString(moment.format('YYYY-MM-DD'));\n\t\t\t} else {\n\t\t\t\treturn ICAL.Time.fromDateTimeString(moment.format('YYYY-MM-DDTHH:mm:ss'));\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.initDueDate = function (task) {\n\t\t\tvar start = moment(task.start, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar due = moment(task.due, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tif (!due.isValid()) {\n\t\t\t\tvar reference = start.isAfter() ? start : moment();\n\t\t\t\tif (task.allDay) {\n\t\t\t\t\treference.startOf('day').add(1, 'd');\n\t\t\t\t} else {\n\t\t\t\t\treference.startOf('hour').add(1, 'h');\n\t\t\t\t}\n\t\t\t\treturn this.setDue(task, reference, 'all');\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setDue = function (task, date, type) {\n\t\t\tif (type === null) {\n\t\t\t\ttype = 'day';\n\t\t\t}\n\t\t\tvar allDay = task.allDay;\n\t\t\tvar start = moment(task.start, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar olddue = moment(task.due, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar due = olddue.clone();\n\t\t\tif (type === 'day') {\n\t\t\t\tif (moment(due).isValid()) {\n\t\t\t\t\tdue.year(date.year()).month(date.month()).date(date.date());\n\t\t\t\t} else {\n\t\t\t\t\tdue = date.add(12, 'h');\n\t\t\t\t}\n\t\t\t} else if (type === 'time') {\n\t\t\t\tif (moment(due).isValid()) {\n\t\t\t\t\tdue.hour(date.hour()).minute(date.minute());\n\t\t\t\t} else {\n\t\t\t\t\tdue = date;\n\t\t\t\t}\n\t\t\t} else if (type === 'all') {\n\t\t\t\tdue = date;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (due.isBefore(start) || due.isSame(start)) {\n\t\t\t\tstart.subtract(olddue.diff(due), 'ms');\n\t\t\t\ttask.start = this.momentToICALTime(start, allDay);\n\t\t\t}\n\t\t\ttask.due = this.momentToICALTime(due, allDay);\n\t\t\t// this.checkReminderDate(task);\n\t\t\tthis.doUpdate(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.deleteDueDate = function (task) {\n\t\t\t// var reminder = task.reminder;\n\t\t\t//  if (reminder !== null && reminder.type === 'DURATION' && reminder.duration.params.related === 'END') {\n\t\t\t// this.deleteReminderDate(task);\n\t\t\t//  }\n\t\t\ttask.due = null;\n\t\t\tthis.doUpdate(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.initStartDate = function (task) {\n\t\t\tvar start = moment(task.start, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar due = moment(task.due, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tif (!start.isValid()) {\n\t\t\t\tvar reference = moment().add(1, 'h');\n\t\t\t\tif (due.isBefore(reference)) {\n\t\t\t\t\treference = due.subtract(1, 'm');\n\t\t\t\t}\n\t\t\t\treference.startOf(task.allDay ? 'day' : 'hour');\n\t\t\t\treturn this.setStart(task, reference, 'all');\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setStart = function (task, date, type) {\n\t\t\tif (type === null) {\n\t\t\t\ttype = 'day';\n\t\t\t}\n\t\t\tvar allDay = task.allDay;\n\t\t\tvar due = moment(task.due, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar oldstart = moment(task.start, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\tvar start = oldstart.clone();\n\t\t\tif (type === 'day') {\n\t\t\t\tif (moment(start).isValid()) {\n\t\t\t\t\tstart.year(date.year()).month(date.month()).date(date.date());\n\t\t\t\t} else {\n\t\t\t\t\tstart = date.add(12, 'h');\n\t\t\t\t}\n\t\t\t} else if (type === 'time') {\n\t\t\t\tif (moment(start).isValid()) {\n\t\t\t\t\tstart.hour(date.hour()).minute(date.minute());\n\t\t\t\t} else {\n\t\t\t\t\tstart = date;\n\t\t\t\t}\n\t\t\t} else if (type === 'all') {\n\t\t\t\tstart = date;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (start.isAfter(due) || start.isSame(due)) {\n\t\t\t\tdue.add(start.diff(oldstart), 'ms');\n\t\t\t\ttask.due = this.momentToICALTime(due, allDay);\n\t\t\t}\n\t\t\ttask.start = this.momentToICALTime(start, allDay);\n\t\t\t// this.checkReminderDate(taskID);\n\t\t\tthis.doUpdate(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.deleteStartDate = function (task) {\n\t\t\t// var reminder = task.reminder;\n\t\t\t// if (reminder !== null && reminder.type === 'DURATION' && reminder.duration.params.related === 'START') {\n\t\t\t// this.deleteReminderDate(task);\n\t\t\t// }\n\t\t\ttask.start = null;\n\t\t\tthis.doUpdate(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setAllDay = function (task, allDay) {\n\t\t\ttask.allDay = allDay;\n\t\t\tif (allDay) {\n\t\t\t\tvar due = moment(task.due, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\t\tvar start = moment(task.start, \"YYYY-MM-DDTHH:mm:ss\");\n\t\t\t\tif (start.isAfter(due) || start.isSame(due)) {\n\t\t\t\t\tstart = moment(due).subtract(1, 'day');\n\t\t\t\t\ttask.start = this.momentToICALTime(start, allDay);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.doUpdate(task);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.initReminder = function (taskID) {\n\t\t\tvar p, task;\n\t\t\tif (!this.checkReminderDate(taskID)) {\n\t\t\t\ttask = this._$tasksmodel.getById(taskID);\n\t\t\t\ttask.reminder = {\n\t\t\t\t\ttype: 'DURATION',\n\t\t\t\t\taction: 'DISPLAY',\n\t\t\t\t\tduration: {\n\t\t\t\t\t\ttoken: 'week',\n\t\t\t\t\t\tweek: 0,\n\t\t\t\t\t\tday: 0,\n\t\t\t\t\t\thour: 0,\n\t\t\t\t\t\tminute: 0,\n\t\t\t\t\t\tsecond: 0,\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tinvert: true\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (moment(task.start, \"YYYYMMDDTHHmmss\").isValid()) {\n\t\t\t\t\tp = task.reminder.duration.params;\n\t\t\t\t\tp.related = 'START';\n\t\t\t\t\tp.id = '10';\n\t\t\t\t} else if (moment(task.due, \"YYYYMMDDTHHmmss\").isValid()) {\n\t\t\t\t\tp = task.reminder.duration.params;\n\t\t\t\t\tp.related = 'END';\n\t\t\t\t\tp.id = '11';\n\t\t\t\t} else {\n\t\t\t\t\ttask.reminder.type = 'DATE-TIME';\n\t\t\t\t\ttask.reminder.date = moment().startOf('hour').add(1, 'h').format('YYYYMMDDTHHmmss');\n\t\t\t\t}\n\t\t\t\treturn this.setReminder(taskID);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setReminderDate = function (taskID, date, type) {\n\t\t\tvar newreminder, reminder, reminderdate;\n\t\t\tif (type === null) {\n\t\t\t\ttype = 'day';\n\t\t\t}\n\t\t\treminder = this._$tasksmodel.getById(taskID).reminder;\n\t\t\tnewreminder = {\n\t\t\t\ttype: 'DATE-TIME',\n\t\t\t\taction: 'DISPLAY',\n\t\t\t\tduration: null\n\t\t\t};\n\t\t\tif (type === 'day') {\n\t\t\t\tif (this.checkReminderDate(taskID) || reminder === null) {\n\t\t\t\t\treminderdate = moment(reminder.date, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\tnewreminder.action = reminder.action;\n\t\t\t\t\tif (reminderdate.isValid() && reminder.type === 'DATE-TIME') {\n\t\t\t\t\t\treminderdate.year(date.year()).month(date.month()).date(date.date());\n\t\t\t\t\t} else {\n\t\t\t\t\t\treminderdate = date.add(12, 'h');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treminderdate = date.add(12, 'h');\n\t\t\t\t}\n\t\t\t} else if (type === 'time') {\n\t\t\t\tif (this.checkReminderDate(taskID) || reminder === null) {\n\t\t\t\t\treminderdate = moment(reminder.date, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\tnewreminder.action = reminder.action;\n\t\t\t\t\tif (reminderdate.isValid() && reminder.type === 'DATE-TIME') {\n\t\t\t\t\t\treminderdate.hour(date.hour()).minute(date.minute());\n\t\t\t\t\t} else {\n\t\t\t\t\t\treminderdate = date;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treminderdate = date;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnewreminder.date = reminderdate.format('YYYYMMDDTHHmmss');\n\t\t\tthis._$tasksmodel.setReminder(taskID, newreminder);\n\t\t\treturn this._persistence.setReminder(taskID, newreminder);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.setReminder = function (taskID) {\n\t\t\tvar reminder;\n\t\t\tif (this.checkReminderDate(taskID)) {\n\t\t\t\treminder = this._$tasksmodel.getById(taskID).reminder;\n\t\t\t\treturn this._persistence.setReminder(taskID, reminder);\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.checkReminderDate = function (taskID) {\n\t\t\tvar d, date, duration, rel, related, reminder, seg, task, token;\n\t\t\ttask = this._$tasksmodel.getById(taskID);\n\t\t\treminder = task.reminder;\n\t\t\tif (reminder !== null && reminder.type === 'DURATION') {\n\t\t\t\tif (!reminder.duration) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (reminder.duration.params.related === 'START') {\n\t\t\t\t\ttoken = 'start';\n\t\t\t\t} else if (reminder.duration.params.related === 'END') {\n\t\t\t\t\ttoken = 'due';\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tdate = moment(task[token], \"YYYYMMDDTHHmmss\");\n\t\t\t\tduration = reminder.duration;\n\t\t\t\td = {\n\t\t\t\t\tw: duration.week,\n\t\t\t\t\td: duration.day,\n\t\t\t\t\th: duration.hour,\n\t\t\t\t\tm: duration.minute,\n\t\t\t\t\ts: duration.second\n\t\t\t\t};\n\t\t\t\tif (duration.params.invert) {\n\t\t\t\t\tdate = date.subtract(d);\n\t\t\t\t} else {\n\t\t\t\t\tdate = date.add(d);\n\t\t\t\t}\n\t\t\t\ttask.reminder.date = date.format('YYYYMMDDTHHmmss');\n\t\t\t} else if (reminder !== null && reminder.type === 'DATE-TIME') {\n\t\t\t\tduration = reminder.duration;\n\t\t\t\tdate = moment(reminder.date, \"YYYYMMDDTHHmmss\");\n\t\t\t\tif (!date.isValid()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (duration) {\n\t\t\t\t\tif (duration.params.related === 'START') {\n\t\t\t\t\t\trelated = moment(task.start, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\trelated = moment(task.due, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\t}\n\t\t\t\t\tseg = this.secondsToSegments(date.diff(related, 'seconds'));\n\t\t\t\t\tduration.params.invert = seg.invert;\n\t\t\t\t\tduration.token = 'week';\n\t\t\t\t\tduration.week = seg.week;\n\t\t\t\t\tduration.day = seg.day;\n\t\t\t\t\tduration.hour = seg.hour;\n\t\t\t\t\tduration.minute = seg.minute;\n\t\t\t\t\tduration.second = seg.second;\n\t\t\t\t} else {\n\t\t\t\t\tif (task.start) {\n\t\t\t\t\t\trelated = moment(task.start, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\t\trel = 'START';\n\t\t\t\t\t\td = 0;\n\t\t\t\t\t} else if (task.due) {\n\t\t\t\t\t\trelated = moment(task.due, \"YYYYMMDDTHHmmss\");\n\t\t\t\t\t\trel = 'END';\n\t\t\t\t\t\td = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tseg = this.secondsToSegments(date.diff(related, 'seconds'));\n\t\t\t\t\treminder.duration = {\n\t\t\t\t\t\ttoken: 'week',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trelated: rel,\n\t\t\t\t\t\t\tinvert: seg.invert,\n\t\t\t\t\t\t\tid: +seg.invert + '' + d\n\t\t\t\t\t\t},\n\t\t\t\t\t\tweek: seg.week,\n\t\t\t\t\t\tday: seg.day,\n\t\t\t\t\t\thour: seg.hour,\n\t\t\t\t\t\tminute: seg.minute,\n\t\t\t\t\t\tsecond: seg.second\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.secondsToSegments = function (s) {\n\t\t\tvar d, h, i, m, w;\n\t\t\tif (s < 0) {\n\t\t\t\ts *= -1;\n\t\t\t\ti = true;\n\t\t\t} else {\n\t\t\t\ti = false;\n\t\t\t}\n\t\t\tw = Math.floor(s / 604800);\n\t\t\ts -= w * 604800;\n\t\t\td = Math.floor(s / 86400);\n\t\t\ts -= d * 86400;\n\t\t\th = Math.floor(s / 3600);\n\t\t\ts -= h * 3600;\n\t\t\tm = Math.floor(s / 60);\n\t\t\ts -= m * 60;\n\t\t\treturn {\n\t\t\t\tweek: w,\n\t\t\t\tday: d,\n\t\t\t\thour: h,\n\t\t\t\tminute: m,\n\t\t\t\tsecond: s,\n\t\t\t\tinvert: i\n\t\t\t};\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.deleteReminderDate = function (taskID) {\n\t\t\tthis._$tasksmodel.setReminder(taskID, null);\n\t\t\treturn this._persistence.setReminder(taskID, false);\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.changeCalendar = function (task, newCalendar) {\n\t\t\tif (task.calendar !== newCalendar && newCalendar.writable) {\n\t\t\t\tvar newTask = angular.copy(task);\n\t\t\t\tnewTask.calendar = newCalendar;\n\t\t\t\tif (!TasksModel.hasNoParent(newTask)) {\n\t\t\t\t\tvar parent = TasksModel.getByUid(newTask.related);\n\t\t\t\t\tif (parent.calendar.uri !== newTask.calendar.uri) {\n\t\t\t\t\t\tnewTask.related = null;\n\t\t\t\t\t\tTasksBusinessLayer.prototype.setPercentComplete(newTask, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn VTodoService.create(newCalendar, newTask.data).then(function (newVTodo) {\n\t\t\t\t\tvar vTodo = new VTodo(newVTodo.calendar, newVTodo.properties, newVTodo.uri);\n\t\t\t\t\tTasksModel.ad(vTodo);\n\t\t\t\t\treturn VTodoService[\"delete\"](task).then(function () {\n\t\t\t\t\t\tTasksModel[\"delete\"](task);\n\t\t\t\t\t\tvar queries = [];\n\t\t\t\t\t\tvar children = TasksModel.getChildren(newTask);\n\t\t\t\t\t\tvar _i, _len, child;\n\t\t\t\t\t\tfor (_i = 0, _len = children.length; _i < _len; _i++) {\n\t\t\t\t\t\t\tchild = children[_i];\n\t\t\t\t\t\t\tif (child.calendar.uri !== newTask.calendar.uri) {\n\t\t\t\t\t\t\t\tqueries.push(TasksBusinessLayer.prototype.changeCalendar(child, newTask.calendar));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.all(queries);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t};\n\n\t\t// called from outside\n\t\tTasksBusinessLayer.prototype.changeCollection = function (taskID, collectionID) {\n\t\t\tvar task = this._$tasksmodel.getById(taskID);\n\t\t\tswitch (collectionID) {\n\t\t\t\tcase 'starred':\n\t\t\t\t\ttask.priority = 9;\n\t\t\t\t\treturn this.doUpdate(task);\n\t\t\t\tcase 'completed':\n\t\t\t\t\treturn this.setPercentComplete(task, 100);\n\t\t\t\tcase 'uncompleted':\n\t\t\t\t\tif (task.completed) {\n\t\t\t\t\t\treturn this.setPercentComplete(task, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'today':\n\t\t\t\t\treturn this.setDue(task, moment().startOf('day').add(12, 'h'), 'all');\n\t\t\t\tcase 'week':\n\t\t\t\tcase 'all':\n\t\t\t\t\treturn false;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.changeParent = function (task, parent) {\n\t\t\tif (parent.calendar.writable) {\n\t\t\t\ttask.related = parent.uid;\n\t\t\t\tparent.hideSubtasks = 0;\n\t\t\t\tif (parent.completed && !task.completed) {\n\t\t\t\t\tthis.setPercentComplete(parent, 0);\n\t\t\t\t} else {\n\t\t\t\t\tthis.doUpdate(parent);\n\t\t\t\t}\n\t\t\t\tif (parent.calendar.uri !== task.calendar.uri) {\n\t\t\t\t\tthis.changeCalendar(task, parent.calendar);\n\t\t\t\t} else {\n\t\t\t\t\tthis.doUpdate(task);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.makeRootTask = function (task, newCalendar, collectionID) {\n\t\t\tif (newCalendar.writable) {\n\t\t\t\tvar requests = [];\n\t\t\t\ttask.related = null;\n\t\t\t\tif (collectionID !== \"completed\" && task.completed) {\n\t\t\t\t\ttask.complete = 0;\n\t\t\t\t}\n\t\t\t\trequests.push(this.changeCollection(task.uri, collectionID));\n\t\t\t\tif (task.calendar !== newCalendar) {\n\t\t\t\t\trequests.push(this.changeCalendar(task, newCalendar));\n\t\t\t\t} else {\n\t\t\t\t\trequests.push(this.doUpdate(task));\n\t\t\t\t}\n\t\t\t\treturn requests;\n\t\t\t}\n\t\t};\n\n\t\tTasksBusinessLayer.prototype.deleteComment = function (taskID, commentID) {\n\t\t\tthis._$tasksmodel.deleteComment(taskID, commentID);\n\t\t\treturn this._persistence.deleteComment(taskID, commentID);\n\t\t};\n\n\t\treturn TasksBusinessLayer;\n\t}();\n\treturn new TasksBusinessLayer(TasksModel, Persistence, VTodoService, VTodo, $timeout);\n}]);","'use strict';\n\nangular.module('Tasks').factory('Calendar', ['$rootScope', '$filter', '$window', function ($rootScope, $filter, $window) {\n\t'use strict';\n\n\tfunction Calendar(url, props, uri) {\n\t\tvar _this = this;\n\n\t\tprops.color = props['{http://apple.com/ns/ical/}calendar-color'];\n\t\tif (typeof props.color !== 'undefined') {\n\t\t\tif (props.color.length === 9) {\n\t\t\t\tprops.color = props.color.substr(0, 7);\n\t\t\t}\n\t\t} else {\n\t\t\tprops.color = '#1d2d44';\n\t\t}\n\n\t\tangular.extend(this, {\n\t\t\t_propertiesBackup: {},\n\t\t\t_properties: {\n\t\t\t\turl: url,\n\t\t\t\turi: uri,\n\t\t\t\tenabled: props['{http://owncloud.org/ns}calendar-enabled'] === '1',\n\t\t\t\tdisplayname: props['{DAV:}displayname'] || t('tasks', 'Unnamed'),\n\t\t\t\tcolor: props.color,\n\t\t\t\torder: parseInt(props['{http://apple.com/ns/ical/}calendar-order']) || 0,\n\t\t\t\tcomponents: {\n\t\t\t\t\tvevent: false,\n\t\t\t\t\tvjournal: false,\n\t\t\t\t\tvtodo: false\n\t\t\t\t},\n\t\t\t\twritable: props.canWrite,\n\t\t\t\tshareable: props.canWrite,\n\t\t\t\tsharedWith: {\n\t\t\t\t\tusers: [],\n\t\t\t\t\tgroups: []\n\t\t\t\t},\n\t\t\t\towner: '',\n\t\t\t\tloadedCompleted: false\n\t\t\t},\n\t\t\t_updatedProperties: []\n\t\t});\n\t\tthis._propertiesBackup = angular.copy(this._properties);\n\n\t\t// angular.extend(this, {\n\t\t// \ttmpId: null,\n\t\t// \tfcEventSource: {\n\t\t// \t\tevents: function (start, end, timezone, callback) {\n\t\t// \t\t\t// console.log('querying events ...');\n\t\t// \t\t\t// TimezoneService.get(timezone).then(function(tz) {\n\t\t// \t\t\t// \t_this.list.loading = true;\n\t\t// \t\t\t// \t$rootScope.$broadcast('reloadCalendarList');\n\n\t\t// \t\t\t// \tVEventService.getAll(_this, start, end).then(function(events) {\n\t\t// \t\t\t// \t\tvar vevents = [];\n\t\t// \t\t\t// \t\tfor (var i = 0; i < events.length; i++) {\n\t\t// \t\t\t// \t\t\tvevents = vevents.concat(events[i].getFcEvent(start, end, tz));\n\t\t// \t\t\t// \t\t}\n\n\t\t// \t\t\t// \t\tcallback(vevents);\n\n\t\t// \t\t\t// \t\t_this.list.loading = false;\n\t\t// \t\t\t// \t\t$rootScope.$broadcast('reloadCalendarList');\n\t\t// \t\t\t// \t});\n\t\t// \t\t\t// });\n\t\t// \t\t},\n\t\t// \t\teditable: this._properties.writable,\n\t\t// \t\tcalendar: this\n\t\t// \t},\n\t\t// \tlist: {\n\t\t// \t\tedit: false,\n\t\t// \t\tloading: this.enabled,\n\t\t// \t\tlocked: false,\n\t\t// \t\teditingShares: false\n\t\t// \t}\n\t\t// });\n\n\t\tvar components = props['{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set'];\n\t\tfor (var i = 0; i < components.length; i++) {\n\t\t\tvar name = components[i].attributes.getNamedItem('name').textContent.toLowerCase();\n\t\t\tif (this._properties.components.hasOwnProperty(name)) {\n\t\t\t\tthis._properties.components[name] = true;\n\t\t\t}\n\t\t}\n\n\t\tvar shares = props['{http://owncloud.org/ns}invite'];\n\t\tif (typeof shares !== 'undefined') {\n\t\t\tfor (var j = 0; j < shares.length; j++) {\n\t\t\t\tvar href = shares[j].getElementsByTagNameNS('DAV:', 'href');\n\t\t\t\tif (href.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\thref = href[0].textContent;\n\n\t\t\t\tvar access = shares[j].getElementsByTagNameNS('http://owncloud.org/ns', 'access');\n\t\t\t\tif (access.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\taccess = access[0];\n\n\t\t\t\tvar readWrite = access.getElementsByTagNameNS('http://owncloud.org/ns', 'read-write');\n\t\t\t\treadWrite = readWrite.length !== 0;\n\n\t\t\t\tif (href.startsWith('principal:principals/users/')) {\n\t\t\t\t\tthis._properties.sharedWith.users.push({\n\t\t\t\t\t\tid: href.substr(27),\n\t\t\t\t\t\tdisplayname: href.substr(27),\n\t\t\t\t\t\twritable: readWrite\n\t\t\t\t\t});\n\t\t\t\t} else if (href.startsWith('principal:principals/groups/')) {\n\t\t\t\t\tthis._properties.sharedWith.groups.push({\n\t\t\t\t\t\tid: href.substr(28),\n\t\t\t\t\t\tdisplayname: href.substr(28),\n\t\t\t\t\t\twritable: readWrite\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar owner = props['{DAV:}owner'];\n\t\tif (typeof owner !== 'undefined' && owner.length !== 0) {\n\t\t\towner = owner[0].textContent.slice(0, -1);\n\t\t\tif (owner.startsWith('/remote.php/dav/principals/users/')) {\n\t\t\t\tthis._properties.owner = owner.substr(33);\n\t\t\t}\n\t\t}\n\n\t\t// this.tmpId = RandomStringService.generate();\n\t}\n\n\tCalendar.prototype = {\n\t\tget url() {\n\t\t\treturn this._properties.url;\n\t\t},\n\t\tget caldav() {\n\t\t\treturn $window.location.origin + this.url;\n\t\t},\n\t\tget exportUrl() {\n\t\t\tvar url = this.url;\n\t\t\t// cut off last slash to have a fancy name for the ics\n\t\t\tif (url.slice(url.length - 1) === '/') {\n\t\t\t\turl = url.slice(0, url.length - 1);\n\t\t\t}\n\t\t\turl += '?export';\n\t\t\treturn url;\n\t\t},\n\t\tget enabled() {\n\t\t\treturn this._properties.enabled;\n\t\t},\n\t\tget uri() {\n\t\t\treturn this._properties.uri;\n\t\t},\n\t\tget components() {\n\t\t\treturn this._properties.components;\n\t\t},\n\t\tset enabled(enabled) {\n\t\t\tthis._properties.enabled = enabled;\n\t\t\tthis._setUpdated('enabled');\n\t\t},\n\t\tget displayname() {\n\t\t\treturn this._properties.displayname;\n\t\t},\n\t\tset displayname(displayname) {\n\t\t\tthis._properties.displayname = displayname;\n\t\t\tthis._setUpdated('displayname');\n\t\t},\n\t\tget color() {\n\t\t\treturn this._properties.color;\n\t\t},\n\t\tset color(color) {\n\t\t\tthis._properties.color = color;\n\t\t\tthis._setUpdated('color');\n\t\t},\n\t\tget sharedWith() {\n\t\t\treturn this._properties.sharedWith;\n\t\t},\n\t\tset sharedWith(sharedWith) {\n\t\t\tthis._properties.sharedWith = sharedWith;\n\t\t},\n\t\tget textColor() {\n\t\t\tvar color = this.color;\n\t\t\tvar fallbackColor = '#fff';\n\t\t\tvar c;\n\t\t\tswitch (color.length) {\n\t\t\t\tcase 4:\n\t\t\t\t\tc = color.match(/^#([0-9a-f]{3})$/i)[1];\n\t\t\t\t\tif (c) {\n\t\t\t\t\t\treturn this._generateTextColor(parseInt(c.charAt(0), 16) * 0x11, parseInt(c.charAt(1), 16) * 0x11, parseInt(c.charAt(2), 16) * 0x11);\n\t\t\t\t\t}\n\t\t\t\t\treturn fallbackColor;\n\n\t\t\t\tcase 7:\n\t\t\t\tcase 9:\n\t\t\t\t\tvar regex = new RegExp('^#([0-9a-f]{' + (color.length - 1) + '})$', 'i');\n\t\t\t\t\tc = color.match(regex)[1];\n\t\t\t\t\tif (c) {\n\t\t\t\t\t\treturn this._generateTextColor(parseInt(c.substr(0, 2), 16), parseInt(c.substr(2, 2), 16), parseInt(c.substr(4, 2), 16));\n\t\t\t\t\t}\n\t\t\t\t\treturn fallbackColor;\n\n\t\t\t\tdefault:\n\t\t\t\t\treturn fallbackColor;\n\t\t\t}\n\t\t},\n\t\tget order() {\n\t\t\treturn this._properties.order;\n\t\t},\n\t\tset order(order) {\n\t\t\tthis._properties.order = order;\n\t\t\tthis._setUpdated('order');\n\t\t},\n\t\tget writable() {\n\t\t\treturn this._properties.writable;\n\t\t},\n\t\tget shareable() {\n\t\t\treturn this._properties.shareable;\n\t\t},\n\t\tget owner() {\n\t\t\treturn this._properties.owner;\n\t\t},\n\t\tget loadedCompleted() {\n\t\t\treturn this._properties.loadedCompleted;\n\t\t},\n\t\tset loadedCompleted(loadedCompleted) {\n\t\t\tthis._properties.loadedCompleted = loadedCompleted;\n\t\t},\n\t\t_setUpdated: function _setUpdated(propName) {\n\t\t\tif (this._updatedProperties.indexOf(propName) === -1) {\n\t\t\t\tthis._updatedProperties.push(propName);\n\t\t\t}\n\t\t},\n\t\tget updatedProperties() {\n\t\t\treturn this._updatedProperties;\n\t\t},\n\t\tresetUpdatedProperties: function resetUpdatedProperties() {\n\t\t\tthis._updatedProperties = [];\n\t\t},\n\t\tprepareUpdate: function prepareUpdate() {\n\t\t\tthis._propertiesBackup = angular.copy(this._properties);\n\t\t},\n\t\tresetToPreviousState: function resetToPreviousState() {\n\t\t\tthis._properties = angular.copy(this._propertiesBackup);\n\t\t\tthis._propertiesBackup = {};\n\t\t},\n\t\tdropPreviousState: function dropPreviousState() {\n\t\t\tthis._propertiesBackup = {};\n\t\t},\n\t\ttoggleSharesEditor: function toggleSharesEditor() {\n\t\t\tthis.list.editingShares = !this.list.editingShares;\n\t\t},\n\t\t_generateTextColor: function _generateTextColor(r, g, b) {\n\t\t\tvar brightness = (r * 299 + g * 587 + b * 114) / 1000;\n\t\t\treturn brightness > 130 ? '#000000' : '#FAFAFA';\n\t\t}\n\t};\n\n\treturn Calendar;\n}]);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __hasProp = {}.hasOwnProperty,\n\t    __extends = function __extends(child, parent) {\n\t\tfor (var key in parent) {\n\t\t\tif (__hasProp.call(parent, key)) {\n\t\t\t\tchild[key] = parent[key];\n\t\t\t}\n\t\t}\n\t\tfunction Ctor() {\n\t\t\tthis.constructor = child;\n\t\t}\n\t\tCtor.prototype = parent.prototype;\n\t\tchild.prototype = new Ctor();\n\t\tchild.__super__ = parent.prototype;\n\t\treturn child;\n\t},\n\t    __indexOf = [].indexOf || function (item) {\n\t\tfor (var i = 0, l = this.length; i < l; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\tangular.module('Tasks').factory('CollectionsModel', ['TasksModel', '_Model', function (TasksModel, _Model) {\n\t\tvar CollectionsModel = function (_super) {\n\n\t\t\tfunction CollectionsModel(_$tasksmodel) {\n\t\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\t\tthis._nameCache = {};\n\t\t\t\tCollectionsModel.__super__.constructor.call(this);\n\t\t\t}\n\n\t\t\t__extends(CollectionsModel, _super);\n\n\t\t\tCollectionsModel.prototype.add = function (data, clearCache) {\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tthis._nameCache[data.displayname] = data;\n\t\t\t\tif (angular.isDefined(data.id)) {\n\t\t\t\t\treturn CollectionsModel.__super__.add.call(this, data, clearCache);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tCollectionsModel.prototype.getCount = function (collectionID, filter) {\n\t\t\t\tvar count, task, tasks, _i, _len;\n\t\t\t\tif (filter === null) {\n\t\t\t\t\tfilter = '';\n\t\t\t\t}\n\t\t\t\tcount = 0;\n\t\t\t\ttasks = this._$tasksmodel.filteredTasks(filter);\n\t\t\t\tfor (_i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\tcount += this._$tasksmodel.filterTasks(task, collectionID) && !task.related;\n\t\t\t\t}\n\t\t\t\treturn count;\n\t\t\t};\n\n\t\t\treturn CollectionsModel;\n\t\t}(_Model);\n\t\treturn new CollectionsModel(TasksModel);\n\t}]);\n}).call(undefined);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __hasProp = {}.hasOwnProperty,\n\t    __extends = function __extends(child, parent) {\n\t\tfor (var key in parent) {\n\t\t\tif (__hasProp.call(parent, key)) {\n\t\t\t\tchild[key] = parent[key];\n\t\t\t}\n\t\t}\n\t\tfunction Ctor() {\n\t\t\tthis.constructor = child;\n\t\t}\n\t\tCtor.prototype = parent.prototype;\n\t\tchild.prototype = new Ctor();\n\t\tchild.__super__ = parent.prototype;\n\t\treturn child;\n\t},\n\t    __indexOf = [].indexOf || function (item) {\n\t\tfor (var i = 0, l = this.length; i < l; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\tangular.module('Tasks').factory('ListsModel', ['TasksModel', '_Model', function (TasksModel, _Model) {\n\t\tvar ListsModel = function (_super) {\n\n\t\t\tfunction ListsModel(_$tasksmodel) {\n\t\t\t\tthis._$tasksmodel = _$tasksmodel;\n\t\t\t\tthis._tmpUriCache = {};\n\t\t\t\tthis._data = [];\n\t\t\t\tthis._dataMap = {};\n\t\t\t\tthis._filterCache = {};\n\t\t\t}\n\n\t\t\t__extends(ListsModel, _super);\n\n\t\t\tListsModel.prototype.add = function (calendar, clearCache) {\n\t\t\t\tvar updateByUri;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tupdateByUri = angular.isDefined(calendar.uri) && angular.isDefined(this.getByUri(calendar.uri));\n\t\t\t\tif (updateByUri) {\n\t\t\t\t\treturn this.update(calendar, clearCache);\n\t\t\t\t} else {\n\t\t\t\t\tif (angular.isDefined(calendar.uri)) {\n\t\t\t\t\t\tif (clearCache) {\n\t\t\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!angular.isDefined(this._dataMap[calendar.uri])) {\n\t\t\t\t\t\t\tthis._data.push(calendar);\n\t\t\t\t\t\t\tthis._dataMap[calendar.uri] = calendar;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tListsModel.prototype.getByUri = function (uri) {\n\t\t\t\treturn this._dataMap[uri];\n\t\t\t};\n\n\t\t\tListsModel.prototype.update = function (list, clearCache) {\n\t\t\t\tvar tmplist;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\ttmplist = this._tmpIdCache[list.tmpID];\n\t\t\t\tif (angular.isDefined(list.id) && angular.isDefined(tmplist) && angular.isUndefined(tmplist.id)) {\n\t\t\t\t\ttmplist.id = list.id;\n\t\t\t\t\tthis._dataMap[list.id] = tmplist;\n\t\t\t\t}\n\t\t\t\tlist[\"void\"] = false;\n\t\t\t\treturn ListsModel.__super__.update.call(this, list, clearCache);\n\t\t\t};\n\n\t\t\tListsModel.prototype[\"delete\"] = function (calendar, clearCache) {\n\t\t\t\tvar counter, data, entry, _i, _len, _ref;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\t_ref = this._data;\n\t\t\t\tfor (counter = _i = 0, _len = _ref.length; _i < _len; counter = ++_i) {\n\t\t\t\t\tentry = _ref[counter];\n\t\t\t\t\tif (entry === calendar) {\n\t\t\t\t\t\tthis._data.splice(counter, 1);\n\t\t\t\t\t\tdata = this._dataMap[calendar.uri];\n\t\t\t\t\t\tdelete this._dataMap[calendar.uri];\n\t\t\t\t\t\tif (clearCache) {\n\t\t\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tListsModel.prototype.getStandardList = function () {\n\t\t\t\tvar calendars;\n\t\t\t\tif (this.size()) {\n\t\t\t\t\tcalendars = this.getAll();\n\t\t\t\t\treturn calendars[0];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tListsModel.prototype.isNameAlreadyTaken = function (displayname, uri) {\n\t\t\t\tvar calendar, calendars, ret, _i, _len;\n\t\t\t\tcalendars = this.getAll();\n\t\t\t\tret = false;\n\t\t\t\tfor (_i = 0, _len = calendars.length; _i < _len; _i++) {\n\t\t\t\t\tcalendar = calendars[_i];\n\t\t\t\t\tif (calendar.displayname === displayname && calendar.uri !== uri) {\n\t\t\t\t\t\tret = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\tListsModel.prototype.getCount = function (calendarID, collectionID, filter) {\n\t\t\t\tvar count, task, tasks, _i, _len;\n\t\t\t\tif (filter === null) {\n\t\t\t\t\tfilter = '';\n\t\t\t\t}\n\t\t\t\tcount = 0;\n\t\t\t\ttasks = this._$tasksmodel.filteredTasks(filter);\n\t\t\t\tfor (_i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\tcount += this._$tasksmodel.filterTasks(task, collectionID) && task.calendar.uri === calendarID && !task.related;\n\t\t\t\t}\n\t\t\t\t//  if (collectionID === 'completed' && filter === '') {\n\t\t\t\t// count += this.notLoaded(calendarID);\n\t\t\t\t//  }\n\t\t\t\treturn count;\n\t\t\t};\n\n\t\t\tListsModel.prototype.loadedCompleted = function (calendarID) {\n\t\t\t\tif (angular.isUndefined(this.getById(calendarID))) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn this.getById(calendarID).loadedCompleted;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tListsModel.prototype.setLoadedCompleted = function (calendarID) {\n\t\t\t\tthis.getById(calendarID).loadedCompleted = true;\n\t\t\t};\n\n\t\t\tListsModel.prototype.getColor = function (calendarID) {\n\t\t\t\tif (angular.isUndefined(this.getById(calendarID))) {\n\t\t\t\t\treturn '#CCCCCC';\n\t\t\t\t} else {\n\t\t\t\t\treturn this.getById(calendarID).calendarcolor;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tListsModel.prototype.getName = function (calendarID) {\n\t\t\t\tif (angular.isUndefined(this.getById(calendarID))) {\n\t\t\t\t\treturn '';\n\t\t\t\t} else {\n\t\t\t\t\treturn this.getById(calendarID).displayname;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn ListsModel;\n\t\t}(_Model);\n\t\treturn new ListsModel(TasksModel);\n\t}]);\n}).call(undefined);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __hasProp = {}.hasOwnProperty,\n\t    __extends = function __extends(child, parent) {\n\t\tfor (var key in parent) {\n\t\t\tif (__hasProp.call(parent, key)) {\n\t\t\t\tchild[key] = parent[key];\n\t\t\t}\n\t\t}\n\t\tfunction Ctor() {\n\t\t\tthis.constructor = child;\n\t\t}\n\t\tCtor.prototype = parent.prototype;\n\t\tchild.prototype = new Ctor();\n\t\tchild.__super__ = parent.prototype;\n\t\treturn child;\n\t},\n\t    __indexOf = [].indexOf || function (item) {\n\t\tfor (var i = 0, l = this.length; i < l; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\tangular.module('Tasks').factory('SettingsModel', ['_Model', function (_Model) {\n\t\tvar SettingsModel = function (_super) {\n\n\t\t\tfunction SettingsModel() {\n\t\t\t\tthis._nameCache = {};\n\t\t\t\tSettingsModel.__super__.constructor.call(this);\n\t\t\t}\n\n\t\t\t__extends(SettingsModel, _super);\n\n\t\t\tSettingsModel.prototype.add = function (data, clearCache) {\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tthis._nameCache[data.displayname] = data;\n\t\t\t\tif (angular.isDefined(data.id)) {\n\t\t\t\t\treturn SettingsModel.__super__.add.call(this, data, clearCache);\n\t\t\t\t} else {\n\t\t\t\t\treturn this._data.push(data);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tSettingsModel.prototype.toggle = function (type, setting) {\n\t\t\t\tvar set;\n\t\t\t\tset = this.getById(type);\n\t\t\t\tthis.getById(type)[setting] = !set[setting];\n\t\t\t};\n\t\t\treturn SettingsModel;\n\t\t}(_Model);\n\t\treturn new SettingsModel();\n\t}]);\n}).call(undefined);","'use strict';\n\n(function () {\n\t'use strict';\n\n\tvar __hasProp = {}.hasOwnProperty,\n\t    __extends = function __extends(child, parent) {\n\t\tfor (var key in parent) {\n\t\t\tif (__hasProp.call(parent, key)) {\n\t\t\t\tchild[key] = parent[key];\n\t\t\t}\n\t\t}\n\t\tfunction Ctor() {\n\t\t\tthis.constructor = child;\n\t\t}\n\t\tCtor.prototype = parent.prototype;\n\t\tchild.prototype = new Ctor();\n\t\tchild.__super__ = parent.prototype;\n\t\treturn child;\n\t},\n\t    __indexOf = [].indexOf || function (item) {\n\t\tfor (var i = 0, l = this.length; i < l; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\tangular.module('Tasks').factory('TasksModel', ['_Model', function (_Model) {\n\t\tvar TasksModel = function (_super) {\n\n\t\t\tfunction TasksModel() {\n\t\t\t\tthis._tmpIdCache = {};\n\t\t\t\tTasksModel.__super__.constructor.call(this);\n\t\t\t}\n\n\t\t\t__extends(TasksModel, _super);\n\n\t\t\tTasksModel.prototype.ad = function (task, clearCache) {\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tvar updateByUri = angular.isDefined(task.uri) && angular.isDefined(this.getByUri(task.uri));\n\t\t\t\tif (updateByUri) {\n\t\t\t\t\treturn this.update(task, clearCache);\n\t\t\t\t} else {\n\t\t\t\t\tif (angular.isDefined(task.uri)) {\n\t\t\t\t\t\tif (clearCache) {\n\t\t\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!angular.isDefined(this._dataMap[task.uri])) {\n\t\t\t\t\t\t\tthis._data.push(task);\n\t\t\t\t\t\t\tthis._dataMap[task.uri] = task;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.getByUri = function (uri) {\n\t\t\t\treturn this._dataMap[uri];\n\t\t\t};\n\n\t\t\tTasksModel.prototype.update = function (task, clearCache) {\n\n\t\t\t\tvar entry, key, value, _results;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\tif (clearCache) {\n\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t}\n\t\t\t\tentry = this.getByUri(task.uri);\n\t\t\t\tentry.components = task.components;\n\t\t\t\tif (entry.components) {\n\t\t\t\t\tentry.components.toString();\n\t\t\t\t}\n\t\t\t\treturn entry;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.removeById = function (taskID) {\n\t\t\t\treturn TasksModel.__super__.removeById.call(this, taskID);\n\t\t\t};\n\n\t\t\tTasksModel.prototype[\"delete\"] = function (task, clearCache) {\n\t\t\t\tvar counter, data, entry, _i, _len, _ref;\n\t\t\t\tif (clearCache === null) {\n\t\t\t\t\tclearCache = true;\n\t\t\t\t}\n\t\t\t\t_ref = this._data;\n\t\t\t\tfor (counter = _i = 0, _len = _ref.length; _i < _len; counter = ++_i) {\n\t\t\t\t\tentry = _ref[counter];\n\t\t\t\t\tif (entry === task) {\n\t\t\t\t\t\tthis._data.splice(counter, 1);\n\t\t\t\t\t\tdata = this._dataMap[task.uri];\n\t\t\t\t\t\tdelete this._dataMap[task.uri];\n\t\t\t\t\t\tif (clearCache) {\n\t\t\t\t\t\t\tthis._invalidateCache();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.removeByList = function (listID) {\n\t\t\t\tvar id, task, taskIDs, tasks, _results;\n\t\t\t\ttasks = this.getAll();\n\t\t\t\ttaskIDs = [];\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\tif (task.calendarid === listID) {\n\t\t\t\t\t\ttaskIDs.push(task.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_results = [];\n\t\t\t\tfor (var _j = 0, _len1 = taskIDs.length; _j < _len1; _j++) {\n\t\t\t\t\tid = taskIDs[_j];\n\t\t\t\t\t_results.push(this.removeById(id));\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.taskAtDay = function (task, date) {\n\t\t\t\tvar diff, due, duediff, start, startdiff;\n\t\t\t\tstart = moment(task.start, \"YYYYMMDDTHHmmss\");\n\t\t\t\tdue = moment(task.due, \"YYYYMMDDTHHmmss\");\n\t\t\t\tif (start.isValid() && !due.isValid()) {\n\t\t\t\t\tdiff = start.diff(moment().startOf('day'), 'days', true);\n\t\t\t\t\tif (!date && diff < date + 1) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (diff < date + 1 && diff >= date) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (due.isValid() && !start.isValid()) {\n\t\t\t\t\tdiff = due.diff(moment().startOf('day'), 'days', true);\n\t\t\t\t\tif (!date && diff < date + 1) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (diff < date + 1 && diff >= date) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (start.isValid() && due.isValid()) {\n\t\t\t\t\tstartdiff = start.diff(moment().startOf('day'), 'days', true);\n\t\t\t\t\tduediff = due.diff(moment().startOf('day'), 'days', true);\n\t\t\t\t\tif (!date && (startdiff < date + 1 || duediff < date + 1)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (startdiff < date + 1 && startdiff >= date && duediff >= date) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (duediff < date + 1 && duediff >= date && startdiff >= date) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.isLoaded = function (task) {\n\t\t\t\tif (this.getById(task.id)) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.hasSubtasks = function (uid) {\n\t\t\t\tvar tasks = this.getAll();\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\tvar task = tasks[_i];\n\t\t\t\t\tif (task.related === uid) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.hasCompletedSubtasks = function (uid) {\n\t\t\t\tvar tasks = this.getAll();\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\tvar task = tasks[_i];\n\t\t\t\t\tif (task.related === uid && task.completed) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.hasNoParent = function (task) {\n\t\t\t\tif (!task.related) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tvar tasks = this.getAll();\n\t\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\t\tvar t = tasks[_i];\n\t\t\t\t\t\tif (task.related === t.uid && task !== t) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.getIdByUid = function (uid) {\n\t\t\t\tvar tasks = this.getAll();\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\tvar task = tasks[_i];\n\t\t\t\t\tif (task.uid === uid) {\n\t\t\t\t\t\treturn task.id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.getByUid = function (uid) {\n\t\t\t\tvar tasks = this.getAll();\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\tvar task = tasks[_i];\n\t\t\t\t\tif (task.uid === uid) {\n\t\t\t\t\t\treturn task;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.getChildren = function (task) {\n\t\t\t\tvar children, t, tasks;\n\t\t\t\ttasks = this.getAll();\n\t\t\t\tchildren = [];\n\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\tt = tasks[_i];\n\t\t\t\t\tif (t.related === task.uid && t !== task) {\n\t\t\t\t\t\tchildren.push(t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn children;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.getDescendantIDs = function (task) {\n\t\t\t\tvar child, children, descendantIDs;\n\t\t\t\tchildren = this.getChildren(task);\n\t\t\t\tdescendantIDs = [];\n\t\t\t\tfor (var _i = 0, _len = children.length; _i < _len; _i++) {\n\t\t\t\t\tchild = children[_i];\n\t\t\t\t\tdescendantIDs = descendantIDs.concat(child.uri);\n\t\t\t\t\tdescendantIDs = descendantIDs.concat(this.getDescendantIDs(child));\n\t\t\t\t}\n\t\t\t\treturn descendantIDs;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.filterTasks = function (task, filter) {\n\t\t\t\tswitch (filter) {\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\treturn task.completed === true;\n\t\t\t\t\tcase 'all':\n\t\t\t\t\t\treturn task.completed === false;\n\t\t\t\t\tcase 'current':\n\t\t\t\t\t\treturn task.completed === false && this.current(task.start, task.due);\n\t\t\t\t\tcase 'starred':\n\t\t\t\t\t\treturn task.completed === false && task.priority > 5;\n\t\t\t\t\tcase 'today':\n\t\t\t\t\t\treturn task.completed === false && (this.today(task.start) || this.today(task.due));\n\t\t\t\t\tcase 'week':\n\t\t\t\t\t\treturn task.completed === false && (this.week(task.start) || this.week(task.due));\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '' + task.calendar.uri === '' + filter;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.filteredTasks = function (needle) {\n\t\t\t\tvar ancestors, parentID, ret, task, tasks;\n\t\t\t\tret = [];\n\t\t\t\ttasks = this.getAll();\n\t\t\t\tif (!needle) {\n\t\t\t\t\tret = tasks;\n\t\t\t\t} else {\n\t\t\t\t\tfor (var _i = 0, _len = tasks.length; _i < _len; _i++) {\n\t\t\t\t\t\ttask = tasks[_i];\n\t\t\t\t\t\tif (this.filterTasksByString(task, needle)) {\n\t\t\t\t\t\t\tif (this.objectExists(task, ret)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tret.push(task);\n\t\t\t\t\t\t\tparentID = this.getIdByUid(task.related);\n\t\t\t\t\t\t\tancestors = this.getAncestor(parentID, ret);\n\t\t\t\t\t\t\tif (ancestors) {\n\t\t\t\t\t\t\t\tret = ret.concat(ancestors);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.objectExists = function (task, ret) {\n\t\t\t\tfor (var _i = 0, _len = ret.length; _i < _len; _i++) {\n\t\t\t\t\tvar re = ret[_i];\n\t\t\t\t\tif (re.id === task.id) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.filterTasksByString = function (task, filter) {\n\t\t\t\tvar key, keys, value;\n\t\t\t\tkeys = ['name', 'note', 'location', 'categories', 'comments'];\n\t\t\t\tfilter = filter.toLowerCase();\n\t\t\t\tfor (key in task) {\n\t\t\t\t\tvalue = task[key];\n\t\t\t\t\tif (__indexOf.call(keys, key) >= 0) {\n\t\t\t\t\t\tif (key === 'comments') {\n\t\t\t\t\t\t\tif (this.searchComments(task.comments, filter)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (key === 'categories') {\n\t\t\t\t\t\t\tif (this.searchCategories(task.categories, filter)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (value.toLowerCase().indexOf(filter) !== -1) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.searchComments = function (comments, filter) {\n\t\t\t\tfor (var _i = 0, _len = comments.length; _i < _len; _i++) {\n\t\t\t\t\tvar comment = comments[_i];\n\t\t\t\t\tif (comment.comment.toLowerCase().indexOf(filter) !== -1) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.searchCategories = function (categories, filter) {\n\t\t\t\tfor (var _i = 0, _len = categories.length; _i < _len; _i++) {\n\t\t\t\t\tvar category = categories[_i];\n\t\t\t\t\tif (category.toLowerCase().indexOf(filter) !== -1) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.setReminder = function (taskID, reminder) {\n\t\t\t\treturn this.update({\n\t\t\t\t\tid: taskID,\n\t\t\t\t\treminder: reminder\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tTasksModel.prototype.overdue = function (due) {\n\t\t\t\treturn moment(due, \"YYYYMMDDTHHmmss\").isValid() && moment(due, \"YYYYMMDDTHHmmss\").diff(moment()) < 0;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.due = function (due) {\n\t\t\t\treturn moment(due, 'YYYYMMDDTHHmmss').isValid();\n\t\t\t};\n\n\t\t\tTasksModel.prototype.today = function (due) {\n\t\t\t\treturn moment(due, \"YYYYMMDDTHHmmss\").isValid() && moment(due, \"YYYYMMDDTHHmmss\").diff(moment().startOf('day'), 'days', true) < 1;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.week = function (due) {\n\t\t\t\treturn moment(due, \"YYYYMMDDTHHmmss\").isValid() && moment(due, \"YYYYMMDDTHHmmss\").diff(moment().startOf('day'), 'days', true) < 7;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.current = function (start, due) {\n\t\t\t\treturn !moment(start, \"YYYYMMDDTHHmmss\").isValid() || moment(start, \"YYYYMMDDTHHmmss\").diff(moment(), 'days', true) < 0 || moment(due, \"YYYYMMDDTHHmmss\").diff(moment(), 'days', true) < 0;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.addComment = function (comment, taskID) {\n\t\t\t\tvar task;\n\t\t\t\ttask = this.getById(taskID);\n\t\t\t\tif (task.comments) {\n\t\t\t\t\ttask.comments.push(comment);\n\t\t\t\t} else {\n\t\t\t\t\ttask.comments = [comment];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tTasksModel.prototype.updateComment = function (comment) {\n\t\t\t\tvar com, i, task, _i, _len, _ref, _results;\n\t\t\t\ttask = this.getById(comment.taskID);\n\t\t\t\ti = 0;\n\t\t\t\t_ref = task.comments;\n\t\t\t\t_results = [];\n\t\t\t\tfor (_i = 0, _len = _ref.length; _i < _len; _i++) {\n\t\t\t\t\tcom = _ref[_i];\n\t\t\t\t\tif (com.tmpID === comment.tmpID) {\n\t\t\t\t\t\ttask.comments[i] = comment;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t_results.push(i++);\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t};\n\n\t\t\tTasksModel.prototype.deleteComment = function (taskID, commentID) {\n\t\t\t\tvar comment, i, task, _i, _len, _ref, _results;\n\t\t\t\ttask = this.getById(taskID);\n\t\t\t\ti = 0;\n\t\t\t\t_ref = task.comments;\n\t\t\t\t_results = [];\n\t\t\t\tfor (_i = 0, _len = _ref.length; _i < _len; _i++) {\n\t\t\t\t\tcomment = _ref[_i];\n\t\t\t\t\tif (comment.id === commentID) {\n\t\t\t\t\t\ttask.comments.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t_results.push(i++);\n\t\t\t\t}\n\t\t\t\treturn _results;\n\t\t\t};\n\n\t\t\treturn TasksModel;\n\t\t}(_Model);\n\t\treturn new TasksModel();\n\t}]);\n}).call(undefined);","'use strict';\n\nangular.module('Tasks').factory('VTodo', ['$filter', 'ICalFactory', 'RandomStringService', function ($filter, icalfactory, RandomStringService) {\n\t'use strict';\n\n\tfunction VTodo(calendar, props, uri) {\n\t\tvar _this = this;\n\n\t\tangular.extend(this, {\n\t\t\tcalendar: calendar,\n\t\t\tdata: props['{urn:ietf:params:xml:ns:caldav}calendar-data'],\n\t\t\turi: uri,\n\t\t\tetag: props['{DAV:}getetag'] || null,\n\t\t\ttimers: [],\n\t\t\tloaded: false\n\t\t});\n\n\t\tthis.jCal = ICAL.parse(this.data);\n\t\tthis.components = new ICAL.Component(this.jCal);\n\n\t\tif (this.components.jCal.length === 0) {\n\t\t\tthrow \"invalid calendar\";\n\t\t}\n\n\t\tthis.loadComments();\n\t}\n\n\tVTodo.prototype = {\n\t\tget summary() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('summary');\n\t\t},\n\t\tset summary(summary) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('summary', summary);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget priority() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar priority = vtodos[0].getFirstPropertyValue('priority');\n\t\t\treturn (10 - priority) % 10;\n\t\t},\n\t\tset priority(priority) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('priority', (10 - priority) % 10);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget complete() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('percent-complete') || 0;\n\t\t},\n\t\tset complete(complete) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('percent-complete', complete);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t\tif (complete < 100) {\n\t\t\t\tthis.completed = null;\n\t\t\t\tif (complete === 0) {\n\t\t\t\t\tthis.status = 'NEEDS-ACTION';\n\t\t\t\t} else {\n\t\t\t\t\tthis.status = 'IN-PROCESS';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.completed = ICAL.Time.now();\n\t\t\t\tthis.status = 'COMPLETED';\n\t\t\t}\n\t\t},\n\t\tget completed() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar comp = vtodos[0].getFirstPropertyValue('completed');\n\t\t\tif (comp) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tset completed(completed) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tif (completed) {\n\t\t\t\tvtodos[0].updatePropertyWithValue('completed', completed);\n\t\t\t} else {\n\t\t\t\tvtodos[0].removeProperty('completed');\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget completed_date() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar comp = vtodos[0].getFirstPropertyValue('completed');\n\t\t\tif (comp) {\n\t\t\t\treturn comp.toJSDate();\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tget status() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('status');\n\t\t},\n\t\tset status(status) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('status', status);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget note() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('description') || '';\n\t\t},\n\t\tset note(note) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('description', note);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget uid() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('uid') || '';\n\t\t},\n\t\tget related() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('related-to') || null;\n\t\t},\n\t\tset related(related) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tif (related) {\n\t\t\t\tvtodos[0].updatePropertyWithValue('related-to', related);\n\t\t\t} else {\n\t\t\t\tvtodos[0].removeProperty('related-to');\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget hideSubtasks() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn +vtodos[0].getFirstPropertyValue('x-oc-hidesubtasks') || 0;\n\t\t},\n\t\tset hideSubtasks(hide) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('x-oc-hidesubtasks', +hide);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget hideCompletedSubtasks() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn +vtodos[0].getFirstPropertyValue('x-oc-hidecompletedsubtasks') || 0;\n\t\t},\n\t\tset hideCompletedSubtasks(hide) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('x-oc-hidecompletedsubtasks', +hide);\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget reminder() {\n\t\t\treturn null;\n\t\t},\n\t\tget categories() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar categories = vtodos[0].getFirstProperty('categories');\n\t\t\tif (categories) {\n\t\t\t\treturn categories.getValues();\n\t\t\t} else {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\t\tset categories(cats) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar categories = vtodos[0].getFirstProperty('categories');\n\t\t\tif (cats.length > 0) {\n\t\t\t\tif (categories) {\n\t\t\t\t\tcategories.setValues(cats);\n\t\t\t\t} else {\n\t\t\t\t\tvar prop = new ICAL.Property('categories');\n\t\t\t\t\tprop.setValues(cats);\n\t\t\t\t\tcategories = vtodos[0].addProperty(prop);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvtodos[0].removeProperty('categories');\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget start() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('dtstart');\n\t\t},\n\t\tset start(start) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tif (start) {\n\t\t\t\tvtodos[0].updatePropertyWithValue('dtstart', start);\n\t\t\t} else {\n\t\t\t\tvtodos[0].removeProperty('dtstart');\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget due() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\treturn vtodos[0].getFirstPropertyValue('due');\n\t\t},\n\t\tset due(due) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tif (due) {\n\t\t\t\tvtodos[0].updatePropertyWithValue('due', due);\n\t\t\t} else {\n\t\t\t\tvtodos[0].removeProperty('due');\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget allDay() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar start = vtodos[0].getFirstPropertyValue('dtstart');\n\t\t\tvar due = vtodos[0].getFirstPropertyValue('due');\n\t\t\tvar d = due ? due : start;\n\t\t\treturn d !== null && d.isDate;\n\t\t},\n\t\tset allDay(allDay) {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar start = vtodos[0].getFirstPropertyValue('dtstart');\n\t\t\tif (start) {\n\t\t\t\tstart.isDate = allDay;\n\t\t\t\tvtodos[0].updatePropertyWithValue('dtstart', start);\n\t\t\t}\n\t\t\tvar due = vtodos[0].getFirstPropertyValue('due');\n\t\t\tif (due) {\n\t\t\t\tdue.isDate = allDay;\n\t\t\t\tvtodos[0].updatePropertyWithValue('due', due);\n\t\t\t}\n\t\t\tthis.updateLastModified();\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tget loadedCompleted() {\n\t\t\treturn this.loaded;\n\t\t},\n\t\tset loadedCompleted(loadedCompleted) {\n\t\t\tthis.loaded = loadedCompleted;\n\t\t},\n\t\tget comments() {\n\t\t\treturn this._comments;\n\t\t},\n\t\tset comments(comments) {\n\t\t\tthis._comments = comments;\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].removeAllProperties('comment');\n\t\t\tfor (var i = 0; i < comments.length; i++) {\n\t\t\t\tvtodos[0].addPropertyWithValue('comment', JSON.stringify(comments[i]));\n\t\t\t}\n\t\t\tthis.data = this.components.toString();\n\t\t},\n\t\tupdateLastModified: function updateLastModified() {\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvtodos[0].updatePropertyWithValue('last-modified', ICAL.Time.now());\n\t\t\tvtodos[0].updatePropertyWithValue('dtstamp', ICAL.Time.now());\n\t\t},\n\t\tloadComments: function loadComments() {\n\t\t\tthis._comments = [];\n\t\t\tvar vtodos = this.components.getAllSubcomponents('vtodo');\n\t\t\tvar commentRaw = vtodos[0].getAllProperties('comment');\n\t\t\tif (commentRaw.length > 0) {\n\t\t\t\tfor (var i = 0; i < commentRaw.length; i++) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar commentObject = JSON.parse(commentRaw[i].getValues()[0]);\n\t\t\t\t\t\tthis._comments.push(commentObject);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlog: function log(val) {\n\t\t\tconsole.log(val);\n\t\t}\n\t};\n\n\tVTodo.create = function (task) {\n\t\tvar comp = icalfactory.new();\n\n\t\tvar vtodo = new ICAL.Component('vtodo');\n\t\tcomp.addSubcomponent(vtodo);\n\t\tvtodo.updatePropertyWithValue('created', ICAL.Time.now());\n\t\tvtodo.updatePropertyWithValue('dtstamp', ICAL.Time.now());\n\t\tvtodo.updatePropertyWithValue('last-modified', ICAL.Time.now());\n\t\tvtodo.updatePropertyWithValue('uid', RandomStringService.generate());\n\t\tvtodo.updatePropertyWithValue('summary', task.summary);\n\t\tvtodo.updatePropertyWithValue('priority', task.priority);\n\t\tvtodo.updatePropertyWithValue('percent-complete', task.complete);\n\t\tvtodo.updatePropertyWithValue('x-oc-hidesubtasks', 0);\n\t\tif (task.related) {\n\t\t\tvtodo.updatePropertyWithValue('related-to', task.related);\n\t\t}\n\t\tif (task.note) {\n\t\t\tvtodo.updatePropertyWithValue('description', task.note);\n\t\t}\n\t\tif (task.due) {\n\t\t\tvtodo.updatePropertyWithValue('due', task.due);\n\t\t}\n\t\tif (task.start) {\n\t\t\tvtodo.updatePropertyWithValue('dtstart', task.start);\n\t\t}\n\n\t\treturn new VTodo(task.calendar, {\n\t\t\t'{urn:ietf:params:xml:ns:caldav}calendar-data': comp.toString(),\n\t\t\t'{DAV:}getetag': null\n\t\t}, null);\n\t};\n\n\treturn VTodo;\n}]);"]}